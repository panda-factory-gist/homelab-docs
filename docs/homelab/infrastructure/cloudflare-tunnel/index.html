<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-homelab/infrastructure/cloudflare-tunnel" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Cloudflare Tunnel - Hermes | Olympus Lab</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://docs.olympus-lab.org/img/docusaurus-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://docs.olympus-lab.org/img/docusaurus-social-card.jpg"><meta data-rh="true" property="og:url" content="https://docs.olympus-lab.org/docs/homelab/infrastructure/cloudflare-tunnel"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Cloudflare Tunnel - Hermes | Olympus Lab"><meta data-rh="true" name="description" content="Acc√®s distant s√©curis√© sans port forwarding, nomm√© d&#x27;apr√®s Herm√®s, le messager des dieux."><meta data-rh="true" property="og:description" content="Acc√®s distant s√©curis√© sans port forwarding, nomm√© d&#x27;apr√®s Herm√®s, le messager des dieux."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://docs.olympus-lab.org/docs/homelab/infrastructure/cloudflare-tunnel"><link data-rh="true" rel="alternate" href="https://docs.olympus-lab.org/docs/homelab/infrastructure/cloudflare-tunnel" hreflang="en"><link data-rh="true" rel="alternate" href="https://docs.olympus-lab.org/docs/homelab/infrastructure/cloudflare-tunnel" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Cloudflare Tunnel - Hermes","item":"https://docs.olympus-lab.org/docs/homelab/infrastructure/cloudflare-tunnel"}]}</script><link rel="alternate" type="application/rss+xml" href="/blog/rss.xml" title="Olympus Lab RSS Feed">
<link rel="alternate" type="application/atom+xml" href="/blog/atom.xml" title="Olympus Lab Atom Feed"><link rel="stylesheet" href="/assets/css/styles.8f8624dd.css">
<script src="/assets/js/runtime~main.c4b55e45.js" defer="defer"></script>
<script src="/assets/js/main.b43942cb.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/logo.svg" alt="Olympus Lab Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/img/logo.svg" alt="Olympus Lab Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Olympus Lab</b></a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/docs/intro">Homelab</a><a class="navbar__item navbar__link" href="/blog">Blog</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://github.com/panda-factory-gist" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/intro"><span title="Bienvenue sur mon Homelab DevOps" class="linkLabel_WmDU">Bienvenue sur mon Homelab DevOps</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/docs/homelab/infrastructure/overview"><span title="Homelab" class="categoryLinkLabel_W154">Homelab</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" tabindex="0" href="/docs/homelab/infrastructure/overview"><span title="Infrastructure" class="categoryLinkLabel_W154">Infrastructure</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/homelab/infrastructure/overview"><span title="Vue d&#x27;ensemble de l&#x27;infrastructure" class="linkLabel_WmDU">Vue d&#x27;ensemble de l&#x27;infrastructure</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/homelab/infrastructure/proxmox"><span title="Proxmox VE - Atlas" class="linkLabel_WmDU">Proxmox VE - Atlas</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/homelab/infrastructure/opnsense"><span title="OPNsense - Olympus" class="linkLabel_WmDU">OPNsense - Olympus</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/homelab/infrastructure/cloudflare-tunnel"><span title="Cloudflare Tunnel - Hermes" class="linkLabel_WmDU">Cloudflare Tunnel - Hermes</span></a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/homelab/infrastructure/network"><span title="Architecture R√©seau" class="linkLabel_WmDU">Architecture R√©seau</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/homelab/security/firewall-rules"><span title="S√©curit√©" class="categoryLinkLabel_W154">S√©curit√©</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/homelab/procedures/access-remote"><span title="Proc√©dures" class="categoryLinkLabel_W154">Proc√©dures</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" tabindex="0" href="/docs/homelab/apprentissage/python"><span title="Apprentissage" class="categoryLinkLabel_W154">Apprentissage</span></a></div></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/homelab/guide_devops"><span title="Lab DevOpsüöÄ" class="linkLabel_WmDU">Lab DevOpsüöÄ</span></a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/docs/tutorial/tutorial-basics/create-a-document"><span title="Tutorial" class="categoryLinkLabel_W154">Tutorial</span></a></div></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Homelab</span></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">Infrastructure</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Cloudflare Tunnel - Hermes</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Cloudflare Tunnel - Hermes</h1></header>
<p>Acc√®s distant s√©curis√© sans port forwarding, nomm√© d&#x27;apr√®s Herm√®s, le messager des dieux.</p>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="concept">Concept<a href="#concept" class="hash-link" aria-label="Direct link to Concept" title="Direct link to Concept" translate="no">‚Äã</a></h2>
<p><strong>Cloudflare Tunnel</strong> cr√©e une connexion sortante chiffr√©e entre ton homelab et l&#x27;edge network de Cloudflare. Aucun port n&#x27;est ouvert sur ta box Internet.</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="architecture">Architecture<a href="#architecture" class="hash-link" aria-label="Direct link to Architecture" title="Direct link to Architecture" translate="no">‚Äã</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Internet</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Cloudflare Edge Network</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Tunnel chiffr√© (sortant uniquement)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Container Hermes (CT 202)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ‚Üì</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Services internes (Proxmox, OPNsense)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="avantages">Avantages<a href="#avantages" class="hash-link" aria-label="Direct link to Avantages" title="Direct link to Avantages" translate="no">‚Äã</a></h3>
<ul>
<li class="">‚úÖ <strong>Z√©ro port ouvert</strong> sur la box Internet</li>
<li class="">‚úÖ <strong>IP publique cach√©e</strong> - personne ne conna√Æt ton IP r√©elle</li>
<li class="">‚úÖ <strong>Protection DDoS</strong> gratuite</li>
<li class="">‚úÖ <strong>Certificats SSL</strong> automatiques</li>
<li class="">‚úÖ <strong>Authentification</strong> via Cloudflare Access</li>
<li class="">‚úÖ <strong>Logs d&#x27;audit</strong> complets</li>
<li class="">‚úÖ <strong>Gratuit</strong> pour usage personnel</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="infrastructure">Infrastructure<a href="#infrastructure" class="hash-link" aria-label="Direct link to Infrastructure" title="Direct link to Infrastructure" translate="no">‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="container-lxc">Container LXC<a href="#container-lxc" class="hash-link" aria-label="Direct link to Container LXC" title="Direct link to Container LXC" translate="no">‚Äã</a></h3>
<ul>
<li class=""><strong>ID</strong> : 202</li>
<li class=""><strong>Hostname</strong> : hermes</li>
<li class=""><strong>OS</strong> : Ubuntu 24.04</li>
<li class=""><strong>RAM</strong> : 256 MB</li>
<li class=""><strong>CPU</strong> : 1 core</li>
<li class=""><strong>R√©seau</strong> : vmbr1 (LAN) - DHCP</li>
<li class=""><strong>Service</strong> : cloudflared (systemd)</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="tunnel-cloudflare">Tunnel Cloudflare<a href="#tunnel-cloudflare" class="hash-link" aria-label="Direct link to Tunnel Cloudflare" title="Direct link to Tunnel Cloudflare" translate="no">‚Äã</a></h3>
<ul>
<li class=""><strong>Tunnel ID</strong> : <code>f7fedba1-6be1-4408-a755-e9badd33f9a0</code></li>
<li class=""><strong>Tunnel Name</strong> : opnsense-access</li>
<li class=""><strong>Domaine</strong> : olympus-lab.org</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="installation">Installation<a href="#installation" class="hash-link" aria-label="Direct link to Installation" title="Direct link to Installation" translate="no">‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="√©tape-1--cr√©er-le-container">√âtape 1 : Cr√©er le container<a href="#√©tape-1--cr√©er-le-container" class="hash-link" aria-label="Direct link to √âtape 1 : Cr√©er le container" title="Direct link to √âtape 1 : Cr√©er le container" translate="no">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Sur Proxmox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pct create 202 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  local:vztmpl/ubuntu-24.04-standard_24.04-2_amd64.tar.zst \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --hostname hermes \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --memory 256 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --cores 1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --net0 name=eth0,bridge=vmbr1,ip=dhcp \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --rootfs local-lvm:4 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --unprivileged 1 \</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --password</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># D√©marrer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pct start 202</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="√©tape-2--installer-cloudflared">√âtape 2 : Installer cloudflared<a href="#√©tape-2--installer-cloudflared" class="hash-link" aria-label="Direct link to √âtape 2 : Installer cloudflared" title="Direct link to √âtape 2 : Installer cloudflared" translate="no">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Entrer dans le container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pct enter 202</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Mise √† jour</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apt update &amp;&amp; apt upgrade -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Installer curl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">apt install curl -y</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># T√©l√©charger cloudflared</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">curl -L https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64 -o /usr/local/bin/cloudflared</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Rendre ex√©cutable</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">chmod +x /usr/local/bin/cloudflared</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># V√©rifier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cloudflared --version</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="√©tape-3--se-connecter-√†-cloudflare">√âtape 3 : Se connecter √† Cloudflare<a href="#√©tape-3--se-connecter-√†-cloudflare" class="hash-link" aria-label="Direct link to √âtape 3 : Se connecter √† Cloudflare" title="Direct link to √âtape 3 : Se connecter √† Cloudflare" translate="no">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Ajouter /usr/local/bin au PATH</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">export PATH=$PATH:/usr/local/bin</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Login Cloudflare (ouvre un lien dans le navigateur)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cloudflared tunnel login</span><br></span></code></pre></div></div>
<p><strong>Copie le lien</strong> affich√©, ouvre-le dans ton navigateur :</p>
<ol>
<li class="">Connecte-toi √† Cloudflare</li>
<li class="">S√©lectionne <strong>olympus-lab.org</strong></li>
<li class="">Clique <strong>Authorize</strong></li>
</ol>
<p>Un fichier <code>cert.pem</code> est cr√©√© dans <code>/root/.cloudflared/</code></p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuration">Configuration<a href="#configuration" class="hash-link" aria-label="Direct link to Configuration" title="Direct link to Configuration" translate="no">‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cr√©er-les-dossiers">Cr√©er les dossiers<a href="#cr√©er-les-dossiers" class="hash-link" aria-label="Direct link to Cr√©er les dossiers" title="Direct link to Cr√©er les dossiers" translate="no">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Cr√©er le dossier de config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">mkdir -p /etc/cloudflared</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Copier le certificat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cp /root/.cloudflared/cert.pem /etc/cloudflared/</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cr√©er-la-configuration">Cr√©er la configuration<a href="#cr√©er-la-configuration" class="hash-link" aria-label="Direct link to Cr√©er la configuration" title="Direct link to Cr√©er la configuration" translate="no">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nano /etc/cloudflared/config.yml</span><br></span></code></pre></div></div>
<p><strong>Contenu</strong> :</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token key atrule" style="color:#00a4db">tunnel</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> f7fedba1</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">6be1</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">4408</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">a755</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">e9badd33f9a0</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">credentials-file</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> /etc/cloudflared/f7fedba1</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">6be1</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">4408</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">a755</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">e9badd33f9a0.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token key atrule" style="color:#00a4db">ingress</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">hostname</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> opnsense.olympus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lab.org</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//10.0.1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">originServerName</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> 10.0.1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">originRequest</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">noTLSVerify</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">hostname</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> proxmox.olympus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lab.org</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> https</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//192.168.1.51</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">8006</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">originRequest</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">      </span><span class="token key atrule" style="color:#00a4db">noTLSVerify</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token boolean important" style="color:#36acaa">true</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">hostname</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ssh</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">proxmox.olympus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lab.org</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> ssh</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//192.168.1.51</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">22</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http_status</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">404</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="r√©cup√©rer-les-credentials">R√©cup√©rer les credentials<a href="#r√©cup√©rer-les-credentials" class="hash-link" aria-label="Direct link to R√©cup√©rer les credentials" title="Direct link to R√©cup√©rer les credentials" translate="no">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># T√©l√©charger les credentials du tunnel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cloudflared tunnel token --cred-file /etc/cloudflared/f7fedba1-6be1-4408-a755-e9badd33f9a0.json f7fedba1-6be1-4408-a755-e9badd33f9a0</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="service-systemd">Service systemd<a href="#service-systemd" class="hash-link" aria-label="Direct link to Service systemd" title="Direct link to Service systemd" translate="no">‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cr√©er-le-service">Cr√©er le service<a href="#cr√©er-le-service" class="hash-link" aria-label="Direct link to Cr√©er le service" title="Direct link to Cr√©er le service" translate="no">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">nano /etc/systemd/system/cloudflared.service</span><br></span></code></pre></div></div>
<p><strong>Contenu</strong> :</p>
<div class="language-ini codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-ini codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">[Unit]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Description=Cloudflare Tunnel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">After=network.target</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Service]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Type=simple</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">User=root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ExecStart=/usr/local/bin/cloudflared tunnel run opnsense-access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Restart=on-failure</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">RestartSec=5s</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">[Install]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">WantedBy=multi-user.target</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="activer-et-d√©marrer">Activer et d√©marrer<a href="#activer-et-d√©marrer" class="hash-link" aria-label="Direct link to Activer et d√©marrer" title="Direct link to Activer et d√©marrer" translate="no">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Recharger systemd</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl daemon-reload</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Activer au d√©marrage</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl enable cloudflared</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># D√©marrer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl start cloudflared</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># V√©rifier le statut</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl status cloudflared</span><br></span></code></pre></div></div>
<p><strong>Statut attendu</strong> :</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">‚óè cloudflared.service - Cloudflare Tunnel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">   Active: active (running)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="voir-les-logs">Voir les logs<a href="#voir-les-logs" class="hash-link" aria-label="Direct link to Voir les logs" title="Direct link to Voir les logs" translate="no">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Logs en temps r√©el</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">journalctl -u cloudflared -f</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Derni√®res 50 lignes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">journalctl -u cloudflared -n 50</span><br></span></code></pre></div></div>
<p><strong>Logs attendus</strong> :</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Connection established to cftunnel.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection established to cftunnel.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection established to cftunnel.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Connection established to cftunnel.com</span><br></span></code></pre></div></div>
<p><strong>4 connexions = tunnel op√©rationnel</strong> ‚úÖ</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="dns-configuration">DNS Configuration<a href="#dns-configuration" class="hash-link" aria-label="Direct link to DNS Configuration" title="Direct link to DNS Configuration" translate="no">‚Äã</a></h2>
<p><strong>Cloudflare Dashboard</strong> ‚Üí <strong>DNS</strong> ‚Üí <strong>Records</strong></p>
<p>Tous les enregistrements pointent vers le tunnel :</p>
<table><thead><tr><th>Type</th><th>Name</th><th>Target</th><th>Proxy</th></tr></thead><tbody><tr><td>CNAME</td><td>opnsense</td><td>f7fedba1-6be1-4408-a755-e9badd33f9a0.cfargotunnel.com</td><td>‚òÅÔ∏è Proxied</td></tr><tr><td>CNAME</td><td>proxmox</td><td>f7fedba1-6be1-4408-a755-e9badd33f9a0.cfargotunnel.com</td><td>‚òÅÔ∏è Proxied</td></tr><tr><td>CNAME</td><td>ssh-proxmox</td><td>f7fedba1-6be1-4408-a755-e9badd33f9a0.cfargotunnel.com</td><td>‚òÅÔ∏è Proxied</td></tr><tr><td>CNAME</td><td>docs</td><td>panda-factory-gist.github.io</td><td>‚òÅÔ∏è OFF</td></tr></tbody></table>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="cloudflare-access-zero-trust">Cloudflare Access (Zero Trust)<a href="#cloudflare-access-zero-trust" class="hash-link" aria-label="Direct link to Cloudflare Access (Zero Trust)" title="Direct link to Cloudflare Access (Zero Trust)" translate="no">‚Äã</a></h2>
<p><strong>Dashboard</strong> : <a href="https://one.dash.cloudflare.com/" target="_blank" rel="noopener noreferrer" class="">https://one.dash.cloudflare.com/</a></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="applications-configur√©es">Applications configur√©es<a href="#applications-configur√©es" class="hash-link" aria-label="Direct link to Applications configur√©es" title="Direct link to Applications configur√©es" translate="no">‚Äã</a></h3>
<table><thead><tr><th>Application</th><th>URL</th><th>Policy</th></tr></thead><tbody><tr><td>OPNsense Admin</td><td>opnsense.olympus-lab.org</td><td>Email authentication</td></tr><tr><td>Proxmox</td><td>proxmox.olympus-lab.org</td><td>Email authentication</td></tr><tr><td>SSH Proxmox</td><td>ssh-proxmox.olympus-lab.org</td><td>Email authentication</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cr√©er-une-application">Cr√©er une application<a href="#cr√©er-une-application" class="hash-link" aria-label="Direct link to Cr√©er une application" title="Direct link to Cr√©er une application" translate="no">‚Äã</a></h3>
<ol>
<li class=""><strong>Access</strong> ‚Üí <strong>Applications</strong> ‚Üí <strong>Add an application</strong></li>
<li class=""><strong>Self-hosted</strong></li>
<li class=""><strong>Application name</strong> : OPNsense Admin</li>
<li class=""><strong>Session duration</strong> : 24 hours</li>
<li class=""><strong>Application domain</strong> : opnsense.olympus-lab.org</li>
<li class=""><strong>Next</strong></li>
</ol>
<p><strong>Policy</strong> :</p>
<ul>
<li class=""><strong>Policy name</strong> : Allow my email</li>
<li class=""><strong>Action</strong> : Allow</li>
<li class=""><strong>Selector</strong> : Emails</li>
<li class=""><strong>Value</strong> : <a href="mailto:ton-email@example.com" target="_blank" rel="noopener noreferrer" class="">ton-email@example.com</a></li>
<li class=""><strong>Add policy</strong> ‚Üí <strong>Done</strong></li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="session">Session<a href="#session" class="hash-link" aria-label="Direct link to Session" title="Direct link to Session" translate="no">‚Äã</a></h3>
<ul>
<li class=""><strong>Dur√©e</strong> : 24 heures (configurable)</li>
<li class=""><strong>Authentification</strong> : Via email (code OTP)</li>
<li class=""><strong>Premi√®re connexion</strong> : Code envoy√© par email</li>
<li class=""><strong>Connexions suivantes</strong> : Cookie de session</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="acc√®s-ssh-via-cloudflare-tunnel">Acc√®s SSH via Cloudflare Tunnel<a href="#acc√®s-ssh-via-cloudflare-tunnel" class="hash-link" aria-label="Direct link to Acc√®s SSH via Cloudflare Tunnel" title="Direct link to Acc√®s SSH via Cloudflare Tunnel" translate="no">‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="sur-windows">Sur Windows<a href="#sur-windows" class="hash-link" aria-label="Direct link to Sur Windows" title="Direct link to Sur Windows" translate="no">‚Äã</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="installation-cloudflared">Installation cloudflared<a href="#installation-cloudflared" class="hash-link" aria-label="Direct link to Installation cloudflared" title="Direct link to Installation cloudflared" translate="no">‚Äã</a></h4>
<ol>
<li class="">T√©l√©charger : <a href="https://github.com/cloudflare/cloudflared/releases/latest" target="_blank" rel="noopener noreferrer" class="">https://github.com/cloudflare/cloudflared/releases/latest</a></li>
<li class="">Fichier : <code>cloudflared-windows-amd64.exe</code></li>
<li class="">Placer dans : <code>C:\Program Files\cloudflared\cloudflared.exe</code></li>
</ol>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuration-ssh">Configuration SSH<a href="#configuration-ssh" class="hash-link" aria-label="Direct link to Configuration SSH" title="Direct link to Configuration SSH" translate="no">‚Äã</a></h4>
<p>Cr√©er/√©diter <code>C:\Users\[TON_USER]\.ssh\config</code> :</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Host ssh-proxmox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    HostName ssh-proxmox.olympus-lab.org</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    User root</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ProxyCommand C:\PROGRA~1\cloudflared\cloudflared.exe access ssh --hostname ssh-proxmox.olympus-lab.org</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="utilisation">Utilisation<a href="#utilisation" class="hash-link" aria-label="Direct link to Utilisation" title="Direct link to Utilisation" translate="no">‚Äã</a></h4>
<div class="language-powershell codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-powershell codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ssh ssh-proxmox</span><br></span></code></pre></div></div>
<p>La premi√®re connexion ouvre le navigateur pour l&#x27;authentification Cloudflare Access.</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="ajouter-un-nouveau-service">Ajouter un nouveau service<a href="#ajouter-un-nouveau-service" class="hash-link" aria-label="Direct link to Ajouter un nouveau service" title="Direct link to Ajouter un nouveau service" translate="no">‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="exemple--ajouter-gitlab">Exemple : Ajouter GitLab<a href="#exemple--ajouter-gitlab" class="hash-link" aria-label="Direct link to Exemple : Ajouter GitLab" title="Direct link to Exemple : Ajouter GitLab" translate="no">‚Äã</a></h3>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="1-modifier-la-config-du-tunnel">1. Modifier la config du tunnel<a href="#1-modifier-la-config-du-tunnel" class="hash-link" aria-label="Direct link to 1. Modifier la config du tunnel" title="Direct link to 1. Modifier la config du tunnel" translate="no">‚Äã</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Dans le container hermes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pct enter 202</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nano /etc/cloudflared/config.yml</span><br></span></code></pre></div></div>
<p><strong>Ajouter</strong> avant la derni√®re ligne :</p>
<div class="language-yaml codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-yaml codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">  </span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain"> </span><span class="token key atrule" style="color:#00a4db">hostname</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> gitlab.olympus</span><span class="token punctuation" style="color:#393A34">-</span><span class="token plain">lab.org</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token key atrule" style="color:#00a4db">service</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> http</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain">//10.0.1.100</span><span class="token punctuation" style="color:#393A34">:</span><span class="token number" style="color:#36acaa">80</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="2-red√©marrer-le-service">2. Red√©marrer le service<a href="#2-red√©marrer-le-service" class="hash-link" aria-label="Direct link to 2. Red√©marrer le service" title="Direct link to 2. Red√©marrer le service" translate="no">‚Äã</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">systemctl restart cloudflared</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># V√©rifier</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">journalctl -u cloudflared -f</span><br></span></code></pre></div></div>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="3-cr√©er-le-dns-record">3. Cr√©er le DNS record<a href="#3-cr√©er-le-dns-record" class="hash-link" aria-label="Direct link to 3. Cr√©er le DNS record" title="Direct link to 3. Cr√©er le DNS record" translate="no">‚Äã</a></h4>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cloudflared tunnel route dns opnsense-access gitlab.olympus-lab.org</span><br></span></code></pre></div></div>
<p>Ou manuellement dans Cloudflare Dashboard :</p>
<ul>
<li class="">Type : CNAME</li>
<li class="">Name : gitlab</li>
<li class="">Target : f7fedba1-6be1-4408-a755-e9badd33f9a0.cfargotunnel.com</li>
<li class="">Proxy : ON ‚òÅÔ∏è</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="4-cr√©er-lapplication-cloudflare-access">4. Cr√©er l&#x27;application Cloudflare Access<a href="#4-cr√©er-lapplication-cloudflare-access" class="hash-link" aria-label="Direct link to 4. Cr√©er l&#x27;application Cloudflare Access" title="Direct link to 4. Cr√©er l&#x27;application Cloudflare Access" translate="no">‚Äã</a></h4>
<p><strong><a href="https://one.dash.cloudflare.com/" target="_blank" rel="noopener noreferrer" class="">https://one.dash.cloudflare.com/</a></strong> ‚Üí <strong>Access</strong> ‚Üí <strong>Applications</strong> ‚Üí <strong>Add</strong></p>
<ul>
<li class="">Application domain : gitlab.olympus-lab.org</li>
<li class="">Policy : Allow ton email</li>
</ul>
<h4 class="anchor anchorTargetStickyNavbar_Vzrq" id="5-tester">5. Tester<a href="#5-tester" class="hash-link" aria-label="Direct link to 5. Tester" title="Direct link to 5. Tester" translate="no">‚Äã</a></h4>
<p><a href="https://gitlab.olympus-lab.org" target="_blank" rel="noopener noreferrer" class="">https://gitlab.olympus-lab.org</a></p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="backup">Backup<a href="#backup" class="hash-link" aria-label="Direct link to Backup" title="Direct link to Backup" translate="no">‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="fichiers-critiques-√†-sauvegarder">Fichiers critiques √† sauvegarder<a href="#fichiers-critiques-√†-sauvegarder" class="hash-link" aria-label="Direct link to Fichiers critiques √† sauvegarder" title="Direct link to Fichiers critiques √† sauvegarder" translate="no">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/cloudflared/config.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Credentials (TR√àS IMPORTANT - ne jamais perdre !)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/cloudflared/f7fedba1-6be1-4408-a755-e9badd33f9a0.json</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Certificat</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">/etc/cloudflared/cert.pem</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="m√©thode-de-backup">M√©thode de backup<a href="#m√©thode-de-backup" class="hash-link" aria-label="Direct link to M√©thode de backup" title="Direct link to M√©thode de backup" translate="no">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Depuis Proxmox</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pct exec 202 -- tar czf /tmp/cloudflared-backup.tar.gz /etc/cloudflared</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># T√©l√©charger sur ton PC</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pct pull 202 /tmp/cloudflared-backup.tar.gz ~/cloudflared-backup-$(date +%Y%m%d).tar.gz</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="restauration">Restauration<a href="#restauration" class="hash-link" aria-label="Direct link to Restauration" title="Direct link to Restauration" translate="no">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Uploader le backup</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pct push 202 ~/cloudflared-backup-YYYYMMDD.tar.gz /tmp/cloudflared-backup.tar.gz</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Restaurer</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pct exec 202 -- tar xzf /tmp/cloudflared-backup.tar.gz -C /</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Red√©marrer le service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pct exec 202 -- systemctl restart cloudflared</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="monitoring">Monitoring<a href="#monitoring" class="hash-link" aria-label="Direct link to Monitoring" title="Direct link to Monitoring" translate="no">‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="v√©rifier-l√©tat-du-tunnel">V√©rifier l&#x27;√©tat du tunnel<a href="#v√©rifier-l√©tat-du-tunnel" class="hash-link" aria-label="Direct link to V√©rifier l&#x27;√©tat du tunnel" title="Direct link to V√©rifier l&#x27;√©tat du tunnel" translate="no">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Dans le container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pct enter 202</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Statut du service</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl status cloudflared</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Logs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">journalctl -u cloudflared -f</span><br></span></code></pre></div></div>
<p><strong>Indicateurs de sant√©</strong> :</p>
<ul>
<li class="">4 connexions √©tablies ‚úÖ</li>
<li class="">Aucune erreur dans les logs ‚úÖ</li>
<li class="">Services accessibles via les URLs ‚úÖ</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="cloudflare-analytics">Cloudflare Analytics<a href="#cloudflare-analytics" class="hash-link" aria-label="Direct link to Cloudflare Analytics" title="Direct link to Cloudflare Analytics" translate="no">‚Äã</a></h3>
<p><strong>Dashboard</strong> : <a href="https://one.dash.cloudflare.com/" target="_blank" rel="noopener noreferrer" class="">https://one.dash.cloudflare.com/</a></p>
<ul>
<li class=""><strong>Access</strong> ‚Üí <strong>Analytics</strong> : Statistiques de connexion</li>
<li class=""><strong>Logs</strong> ‚Üí <strong>Access</strong> : Audit des authentifications</li>
<li class=""><strong>Network</strong> : Statistiques du tunnel</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="troubleshooting">Troubleshooting<a href="#troubleshooting" class="hash-link" aria-label="Direct link to Troubleshooting" title="Direct link to Troubleshooting" translate="no">‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="tunnel-ne-d√©marre-pas">Tunnel ne d√©marre pas<a href="#tunnel-ne-d√©marre-pas" class="hash-link" aria-label="Direct link to Tunnel ne d√©marre pas" title="Direct link to Tunnel ne d√©marre pas" translate="no">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># V√©rifier la config YAML</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">nano /etc/cloudflared/config.yml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># V√©rifier l&#x27;indentation (espaces, pas de tabs)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Tester manuellement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">systemctl stop cloudflared</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cloudflared tunnel run opnsense-access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Voir les erreurs d√©taill√©es</span><br></span></code></pre></div></div>
<p><strong>Erreurs communes</strong> :</p>
<ul>
<li class="">Indentation YAML incorrecte</li>
<li class="">Fichier credentials manquant</li>
<li class="">Tunnel ID incorrect</li>
<li class="">Chemin vers credentials-file incorrect</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="service-ne-se-connecte-pas">Service ne se connecte pas<a href="#service-ne-se-connecte-pas" class="hash-link" aria-label="Direct link to Service ne se connecte pas" title="Direct link to Service ne se connecte pas" translate="no">‚Äã</a></h3>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># V√©rifier la connectivit√© Internet du container</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ping -c 3 1.1.1.1</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ping -c 3 cloudflare.com</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># V√©rifier que OPNsense route correctement</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Firewall ‚Üí Log Files ‚Üí Live View</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="page-inaccessible-error-1033">Page inaccessible (Error 1033)<a href="#page-inaccessible-error-1033" class="hash-link" aria-label="Direct link to Page inaccessible (Error 1033)" title="Direct link to Page inaccessible (Error 1033)" translate="no">‚Äã</a></h3>
<p><strong>Cause</strong> : Le tunnel n&#x27;est pas connect√©</p>
<p><strong>Solution</strong> :</p>
<ol>
<li class="">V√©rifier que le container est d√©marr√© : <code>pct status 202</code></li>
<li class="">V√©rifier que le service tourne : <code>pct exec 202 -- systemctl status cloudflared</code></li>
<li class="">Red√©marrer si n√©cessaire : <code>pct exec 202 -- systemctl restart cloudflared</code></li>
</ol>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="authentification-cloudflare-access-ne-fonctionne-pas">Authentification Cloudflare Access ne fonctionne pas<a href="#authentification-cloudflare-access-ne-fonctionne-pas" class="hash-link" aria-label="Direct link to Authentification Cloudflare Access ne fonctionne pas" title="Direct link to Authentification Cloudflare Access ne fonctionne pas" translate="no">‚Äã</a></h3>
<ol>
<li class="">V√©rifier que l&#x27;application existe dans le dashboard</li>
<li class="">V√©rifier la policy (email correct)</li>
<li class="">Essayer en navigation priv√©e</li>
<li class="">V√©rifier les logs Access dans le dashboard</li>
</ol>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="s√©curit√©">S√©curit√©<a href="#s√©curit√©" class="hash-link" aria-label="Direct link to S√©curit√©" title="Direct link to S√©curit√©" translate="no">‚Äã</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="best-practices">Best practices<a href="#best-practices" class="hash-link" aria-label="Direct link to Best practices" title="Direct link to Best practices" translate="no">‚Äã</a></h3>
<ul>
<li class="">‚úÖ <strong>Backup r√©gulier</strong> du dossier <code>/etc/cloudflared/</code></li>
<li class="">‚úÖ <strong>Authentification forte</strong> (email + 2FA Cloudflare)</li>
<li class="">‚úÖ <strong>Policies restrictives</strong> (whitelist emails uniquement)</li>
<li class="">‚úÖ <strong>Monitoring des logs</strong> Access</li>
<li class="">‚úÖ <strong>Session courte</strong> (24h max)</li>
<li class="">‚úÖ <strong>Firewall rules</strong> pour restreindre l&#x27;acc√®s au container</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="limitations">Limitations<a href="#limitations" class="hash-link" aria-label="Direct link to Limitations" title="Direct link to Limitations" translate="no">‚Äã</a></h3>
<ul>
<li class=""><strong>Latence</strong> : +10-50ms due au passage par Cloudflare Edge</li>
<li class=""><strong>Protocoles</strong> : HTTP/HTTPS/SSH uniquement (pas de RDP direct)</li>
<li class=""><strong>Bande passante</strong> : Limit√©e par le plan gratuit (suffisant pour homelab)</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="commandes-utiles">Commandes utiles<a href="#commandes-utiles" class="hash-link" aria-label="Direct link to Commandes utiles" title="Direct link to Commandes utiles" translate="no">‚Äã</a></h2>
<div class="language-bash codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-bash codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain"># Lister les tunnels</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cloudflared tunnel list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Info sur le tunnel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cloudflared tunnel info opnsense-access</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Cr√©er un nouveau tunnel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cloudflared tunnel create nom-tunnel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Supprimer un tunnel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cloudflared tunnel delete nom-tunnel</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Cr√©er une route DNS</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cloudflared tunnel route dns opnsense-access subdomain.olympus-lab.org</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Lister les routes</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cloudflared tunnel route dns list</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Tester la config</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cloudflared tunnel ingress validate</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"># Tester un hostname sp√©cifique</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cloudflared tunnel ingress rule https://proxmox.olympus-lab.org</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="ressources">Ressources<a href="#ressources" class="hash-link" aria-label="Direct link to Ressources" title="Direct link to Ressources" translate="no">‚Äã</a></h2>
<ul>
<li class=""><strong>Documentation officielle</strong> : <a href="https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/" target="_blank" rel="noopener noreferrer" class="">https://developers.cloudflare.com/cloudflare-one/connections/connect-networks/</a></li>
<li class=""><strong>Cloudflare Access</strong> : <a href="https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/" target="_blank" rel="noopener noreferrer" class="">https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/</a></li>
<li class=""><strong>GitHub cloudflared</strong> : <a href="https://github.com/cloudflare/cloudflared" target="_blank" rel="noopener noreferrer" class="">https://github.com/cloudflare/cloudflared</a></li>
<li class=""><strong>Dashboard</strong> : <a href="https://one.dash.cloudflare.com/" target="_blank" rel="noopener noreferrer" class="">https://one.dash.cloudflare.com/</a></li>
</ul></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/homelab/infrastructure/cloudflare-tunnel.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/docs/homelab/infrastructure/opnsense"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">OPNsense - Olympus</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/docs/homelab/infrastructure/network"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">Architecture R√©seau</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#concept" class="table-of-contents__link toc-highlight">Concept</a><ul><li><a href="#architecture" class="table-of-contents__link toc-highlight">Architecture</a></li><li><a href="#avantages" class="table-of-contents__link toc-highlight">Avantages</a></li></ul></li><li><a href="#infrastructure" class="table-of-contents__link toc-highlight">Infrastructure</a><ul><li><a href="#container-lxc" class="table-of-contents__link toc-highlight">Container LXC</a></li><li><a href="#tunnel-cloudflare" class="table-of-contents__link toc-highlight">Tunnel Cloudflare</a></li></ul></li><li><a href="#installation" class="table-of-contents__link toc-highlight">Installation</a><ul><li><a href="#√©tape-1--cr√©er-le-container" class="table-of-contents__link toc-highlight">√âtape 1 : Cr√©er le container</a></li><li><a href="#√©tape-2--installer-cloudflared" class="table-of-contents__link toc-highlight">√âtape 2 : Installer cloudflared</a></li><li><a href="#√©tape-3--se-connecter-√†-cloudflare" class="table-of-contents__link toc-highlight">√âtape 3 : Se connecter √† Cloudflare</a></li></ul></li><li><a href="#configuration" class="table-of-contents__link toc-highlight">Configuration</a><ul><li><a href="#cr√©er-les-dossiers" class="table-of-contents__link toc-highlight">Cr√©er les dossiers</a></li><li><a href="#cr√©er-la-configuration" class="table-of-contents__link toc-highlight">Cr√©er la configuration</a></li><li><a href="#r√©cup√©rer-les-credentials" class="table-of-contents__link toc-highlight">R√©cup√©rer les credentials</a></li></ul></li><li><a href="#service-systemd" class="table-of-contents__link toc-highlight">Service systemd</a><ul><li><a href="#cr√©er-le-service" class="table-of-contents__link toc-highlight">Cr√©er le service</a></li><li><a href="#activer-et-d√©marrer" class="table-of-contents__link toc-highlight">Activer et d√©marrer</a></li><li><a href="#voir-les-logs" class="table-of-contents__link toc-highlight">Voir les logs</a></li></ul></li><li><a href="#dns-configuration" class="table-of-contents__link toc-highlight">DNS Configuration</a></li><li><a href="#cloudflare-access-zero-trust" class="table-of-contents__link toc-highlight">Cloudflare Access (Zero Trust)</a><ul><li><a href="#applications-configur√©es" class="table-of-contents__link toc-highlight">Applications configur√©es</a></li><li><a href="#cr√©er-une-application" class="table-of-contents__link toc-highlight">Cr√©er une application</a></li><li><a href="#session" class="table-of-contents__link toc-highlight">Session</a></li></ul></li><li><a href="#acc√®s-ssh-via-cloudflare-tunnel" class="table-of-contents__link toc-highlight">Acc√®s SSH via Cloudflare Tunnel</a><ul><li><a href="#sur-windows" class="table-of-contents__link toc-highlight">Sur Windows</a></li></ul></li><li><a href="#ajouter-un-nouveau-service" class="table-of-contents__link toc-highlight">Ajouter un nouveau service</a><ul><li><a href="#exemple--ajouter-gitlab" class="table-of-contents__link toc-highlight">Exemple : Ajouter GitLab</a></li></ul></li><li><a href="#backup" class="table-of-contents__link toc-highlight">Backup</a><ul><li><a href="#fichiers-critiques-√†-sauvegarder" class="table-of-contents__link toc-highlight">Fichiers critiques √† sauvegarder</a></li><li><a href="#m√©thode-de-backup" class="table-of-contents__link toc-highlight">M√©thode de backup</a></li><li><a href="#restauration" class="table-of-contents__link toc-highlight">Restauration</a></li></ul></li><li><a href="#monitoring" class="table-of-contents__link toc-highlight">Monitoring</a><ul><li><a href="#v√©rifier-l√©tat-du-tunnel" class="table-of-contents__link toc-highlight">V√©rifier l&#39;√©tat du tunnel</a></li><li><a href="#cloudflare-analytics" class="table-of-contents__link toc-highlight">Cloudflare Analytics</a></li></ul></li><li><a href="#troubleshooting" class="table-of-contents__link toc-highlight">Troubleshooting</a><ul><li><a href="#tunnel-ne-d√©marre-pas" class="table-of-contents__link toc-highlight">Tunnel ne d√©marre pas</a></li><li><a href="#service-ne-se-connecte-pas" class="table-of-contents__link toc-highlight">Service ne se connecte pas</a></li><li><a href="#page-inaccessible-error-1033" class="table-of-contents__link toc-highlight">Page inaccessible (Error 1033)</a></li><li><a href="#authentification-cloudflare-access-ne-fonctionne-pas" class="table-of-contents__link toc-highlight">Authentification Cloudflare Access ne fonctionne pas</a></li></ul></li><li><a href="#s√©curit√©" class="table-of-contents__link toc-highlight">S√©curit√©</a><ul><li><a href="#best-practices" class="table-of-contents__link toc-highlight">Best practices</a></li><li><a href="#limitations" class="table-of-contents__link toc-highlight">Limitations</a></li></ul></li><li><a href="#commandes-utiles" class="table-of-contents__link toc-highlight">Commandes utiles</a></li><li><a href="#ressources" class="table-of-contents__link toc-highlight">Ressources</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/docs/homelab/infrastructure/overview">Vue d&#x27;ensemble</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/homelab/procedures/access-remote">Acc√®s distant</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/homelab/procedures/maintenance">Maintenance</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Acc√®s</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://proxmox.olympus-lab.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">Proxmox<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://opnsense.olympus-lab.org" target="_blank" rel="noopener noreferrer" class="footer__link-item">OPNsense<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://one.dash.cloudflare.com" target="_blank" rel="noopener noreferrer" class="footer__link-item">Cloudflare<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Plus</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/blog">Blog</a></li><li class="footer__item"><a href="https://github.com/panda-factory-gist" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="margin-bottom--sm"><img src="/img/logo.svg" alt="Olympus Lab Logo" class="footer__logo themedComponent_mlkZ themedComponent--light_NVdE" width="50" height="50"><img src="/img/logo.svg" alt="Olympus Lab Logo" class="footer__logo themedComponent_mlkZ themedComponent--dark_xIcU" width="50" height="50"></div><div class="footer__copyright">Copyright ¬© 2025 Olympus Lab üå∏ Built with Docusaurus.</div></div></div></footer></div>
</body>
</html>