"use strict";(globalThis.webpackChunkhomelab_docs=globalThis.webpackChunkhomelab_docs||[]).push([[191],{266:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>d,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>i,toc:()=>t});const i=JSON.parse('{"id":"homelab/procedures/access-remote","title":"Acc\xe8s distant","description":"Guide complet pour acc\xe9der \xe0 l\'infrastructure Olympus Lab depuis n\'importe o\xf9 dans le monde.","source":"@site/docs/homelab/procedures/access-remote.md","sourceDirName":"homelab/procedures","slug":"/homelab/procedures/access-remote","permalink":"/docs/homelab/procedures/access-remote","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/homelab/procedures/access-remote.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1,"sidebar_label":"Acces Remote"},"sidebar":"tutorialSidebar","previous":{"title":"R\xe8gles Firewall d\xe9taill\xe9es","permalink":"/docs/homelab/security/firewall-rules"},"next":{"title":"Maintenance","permalink":"/docs/homelab/procedures/maintenance"}}');var r=s(4848),l=s(8453);const o={sidebar_position:1,sidebar_label:"Acces Remote"},c="Acc\xe8s distant",d={},t=[{value:"Vue d&#39;ensemble",id:"vue-densemble",level:2},{value:"Acc\xe8s Web",id:"acc\xe8s-web",level:2},{value:"Services disponibles",id:"services-disponibles",level:3},{value:"Proc\xe9dure de connexion Web",id:"proc\xe9dure-de-connexion-web",level:3},{value:"\xc9tape 1 : Ouvrir l&#39;URL",id:"\xe9tape-1--ouvrir-lurl",level:4},{value:"\xc9tape 2 : Authentification Cloudflare Access",id:"\xe9tape-2--authentification-cloudflare-access",level:4},{value:"\xc9tape 3 : Authentification du service",id:"\xe9tape-3--authentification-du-service",level:4},{value:"Troubleshooting Web",id:"troubleshooting-web",level:3},{value:"Erreur &quot;Access Denied&quot;",id:"erreur-access-denied",level:4},{value:"Erreur 1033 &quot;Tunnel error&quot;",id:"erreur-1033-tunnel-error",level:4},{value:"Certificat invalide",id:"certificat-invalide",level:4},{value:"Acc\xe8s SSH",id:"acc\xe8s-ssh",level:2},{value:"Pr\xe9requis",id:"pr\xe9requis",level:3},{value:"Installation cloudflared",id:"installation-cloudflared",level:3},{value:"Windows",id:"windows",level:4},{value:"Linux / macOS",id:"linux--macos",level:4},{value:"Configuration SSH",id:"configuration-ssh",level:3},{value:"Windows",id:"windows-1",level:4},{value:"Linux / macOS",id:"linux--macos-1",level:4},{value:"Utilisation SSH",id:"utilisation-ssh",level:3},{value:"Premi\xe8re connexion",id:"premi\xe8re-connexion",level:4},{value:"Connexions suivantes",id:"connexions-suivantes",level:4},{value:"Ajouter d&#39;autres machines SSH",id:"ajouter-dautres-machines-ssh",level:3},{value:"Exemple : Ajouter une VM GitLab",id:"exemple--ajouter-une-vm-gitlab",level:4},{value:"Troubleshooting SSH",id:"troubleshooting-ssh",level:3},{value:"&quot;Could not resolve hostname&quot;",id:"could-not-resolve-hostname",level:4},{value:"&quot;Permission denied (publickey)&quot;",id:"permission-denied-publickey",level:4},{value:"cloudflared non trouv\xe9",id:"cloudflared-non-trouv\xe9",level:4},{value:"Navigateur ne s&#39;ouvre pas pour l&#39;authentification",id:"navigateur-ne-souvre-pas-pour-lauthentification",level:4},{value:"Acc\xe8s depuis diff\xe9rents appareils",id:"acc\xe8s-depuis-diff\xe9rents-appareils",level:2},{value:"Laptop personnel",id:"laptop-personnel",level:3},{value:"PC du travail (si autoris\xe9)",id:"pc-du-travail-si-autoris\xe9",level:3},{value:"T\xe9l\xe9phone/Tablette",id:"t\xe9l\xe9phonetablette",level:3},{value:"Option 1 : Interface Web",id:"option-1--interface-web",level:4},{value:"Option 2 : App SSH (Termius, JuiceSSH)",id:"option-2--app-ssh-termius-juicessh",level:4},{value:"Sc\xe9narios d&#39;usage",id:"sc\xe9narios-dusage",level:2},{value:"Sc\xe9nario 1 : Chez tes parents en d\xe9cembre",id:"sc\xe9nario-1--chez-tes-parents-en-d\xe9cembre",level:3},{value:"Sc\xe9nario 2 : Urgence depuis le t\xe9l\xe9phone",id:"sc\xe9nario-2--urgence-depuis-le-t\xe9l\xe9phone",level:3},{value:"Sc\xe9nario 3 : Depuis un r\xe9seau restrictif (entreprise, \xe9cole)",id:"sc\xe9nario-3--depuis-un-r\xe9seau-restrictif-entreprise-\xe9cole",level:3},{value:"S\xe9curit\xe9 de l&#39;acc\xe8s distant",id:"s\xe9curit\xe9-de-lacc\xe8s-distant",level:2},{value:"Authentification multi-facteurs",id:"authentification-multi-facteurs",level:3},{value:"Bonnes pratiques",id:"bonnes-pratiques",level:3},{value:"R\xe9voquer un acc\xe8s",id:"r\xe9voquer-un-acc\xe8s",level:3},{value:"Monitoring des connexions",id:"monitoring-des-connexions",level:2},{value:"Voir qui se connecte",id:"voir-qui-se-connecte",level:3},{value:"Alertes",id:"alertes",level:3},{value:"Co\xfbts",id:"co\xfbts",level:2},{value:"Alternatives",id:"alternatives",level:2},{value:"WireGuard VPN (non impl\xe9ment\xe9)",id:"wireguard-vpn-non-impl\xe9ment\xe9",level:3},{value:"Tailscale (test\xe9, non fonctionnel pour subnet routing)",id:"tailscale-test\xe9-non-fonctionnel-pour-subnet-routing",level:3},{value:"Ressources",id:"ressources",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n.header,{children:(0,r.jsx)(n.h1,{id:"acc\xe8s-distant",children:"Acc\xe8s distant"})}),"\n",(0,r.jsx)(n.p,{children:"Guide complet pour acc\xe9der \xe0 l'infrastructure Olympus Lab depuis n'importe o\xf9 dans le monde."}),"\n",(0,r.jsx)(n.h2,{id:"vue-densemble",children:"Vue d'ensemble"}),"\n",(0,r.jsx)(n.p,{children:"Trois m\xe9thodes d'acc\xe8s distant :"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Interface Web"})," (Proxmox, OPNsense) \u2192 via navigateur"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"SSH"})," \u2192 via terminal"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Documentation"})," \u2192 GitHub Pages (publique)"]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"S\xe9curit\xe9"})," : Toutes les connexions passent par Cloudflare Tunnel avec authentification obligatoire (sauf docs publiques)."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"acc\xe8s-web",children:"Acc\xe8s Web"}),"\n",(0,r.jsx)(n.h3,{id:"services-disponibles",children:"Services disponibles"}),"\n",(0,r.jsxs)(n.table,{children:[(0,r.jsx)(n.thead,{children:(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.th,{children:"Service"}),(0,r.jsx)(n.th,{children:"URL"}),(0,r.jsx)(n.th,{children:"Usage"})]})}),(0,r.jsxs)(n.tbody,{children:[(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Proxmox VE"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://proxmox.olympus-lab.org",children:"https://proxmox.olympus-lab.org"})}),(0,r.jsx)(n.td,{children:"Gestion des VMs/containers"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"OPNsense"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://opnsense.olympus-lab.org",children:"https://opnsense.olympus-lab.org"})}),(0,r.jsx)(n.td,{children:"Configuration firewall"})]}),(0,r.jsxs)(n.tr,{children:[(0,r.jsx)(n.td,{children:"Documentation"}),(0,r.jsx)(n.td,{children:(0,r.jsx)(n.a,{href:"https://docs.olympus-lab.org",children:"https://docs.olympus-lab.org"})}),(0,r.jsx)(n.td,{children:"Documentation publique"})]})]})]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"proc\xe9dure-de-connexion-web",children:"Proc\xe9dure de connexion Web"}),"\n",(0,r.jsx)(n.h4,{id:"\xe9tape-1--ouvrir-lurl",children:"\xc9tape 1 : Ouvrir l'URL"}),"\n",(0,r.jsxs)(n.p,{children:["Exemple : ",(0,r.jsx)(n.strong,{children:(0,r.jsx)(n.a,{href:"https://proxmox.olympus-lab.org",children:"https://proxmox.olympus-lab.org"})})]}),"\n",(0,r.jsx)(n.h4,{id:"\xe9tape-2--authentification-cloudflare-access",children:"\xc9tape 2 : Authentification Cloudflare Access"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Premi\xe8re visite"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:'1. Page Cloudflare Access s\'affiche\n2. Entre ton email (celui autoris\xe9 dans la policy)\n3. Clique "Send me a code"\n4. V\xe9rifie tes emails\n5. Entre le code re\xe7u (6 chiffres)\n6. Authentification r\xe9ussie \u2705\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Visites suivantes"})," :"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Cookie de session valide 24h"}),"\n",(0,r.jsx)(n.li,{children:"Pas besoin de re-authentification pendant 24h"}),"\n",(0,r.jsx)(n.li,{children:"Apr\xe8s 24h, redemander le code"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"\xe9tape-3--authentification-du-service",children:"\xc9tape 3 : Authentification du service"}),"\n",(0,r.jsx)(n.p,{children:"Apr\xe8s Cloudflare Access, authentification du service lui-m\xeame :"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Proxmox"})," :"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["User : ",(0,r.jsx)(n.code,{children:"root@pam"})]}),"\n",(0,r.jsx)(n.li,{children:"Password : [ton mot de passe Proxmox]"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"OPNsense"})," :"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["User : ",(0,r.jsx)(n.code,{children:"root"})]}),"\n",(0,r.jsx)(n.li,{children:"Password : [ton mot de passe OPNsense]"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"troubleshooting-web",children:"Troubleshooting Web"}),"\n",(0,r.jsx)(n.h4,{id:"erreur-access-denied",children:'Erreur "Access Denied"'}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"})," : Ton email n'est pas dans la policy Cloudflare Access"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"})," :"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:["Va sur ",(0,r.jsx)(n.a,{href:"https://one.dash.cloudflare.com/",children:"https://one.dash.cloudflare.com/"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Access"})," \u2192 ",(0,r.jsx)(n.strong,{children:"Applications"})]}),"\n",(0,r.jsx)(n.li,{children:"Trouve l'application (ex: Proxmox)"}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Edit"})," \u2192 ",(0,r.jsx)(n.strong,{children:"Policies"})]}),"\n",(0,r.jsx)(n.li,{children:"Ajoute ton email dans la liste"}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Save"})}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"erreur-1033-tunnel-error",children:'Erreur 1033 "Tunnel error"'}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"})," : Le container Cloudflare Tunnel (hermes) n'est pas d\xe9marr\xe9"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# SSH vers Proxmox (voir section SSH ci-dessous)\nssh ssh-proxmox\n\n# V\xe9rifier le container\npct status 202\n\n# D\xe9marrer si arr\xeat\xe9\npct start 202\n\n# V\xe9rifier le service\npct exec 202 -- systemctl status cloudflared\n"})}),"\n",(0,r.jsx)(n.h4,{id:"certificat-invalide",children:"Certificat invalide"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause normale"})," : Proxmox et OPNsense utilisent des certificats auto-sign\xe9s"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Dans le navigateur"})," :"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:'Chrome/Edge : Cliquer "Avanc\xe9" \u2192 "Continuer vers le site"'}),"\n",(0,r.jsx)(n.li,{children:'Firefox : "Avanc\xe9" \u2192 "Accepter le risque"'}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"C'est normal et s\xe9curis\xe9"})," : Le tunnel Cloudflare chiffre la connexion de bout en bout."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"acc\xe8s-ssh",children:"Acc\xe8s SSH"}),"\n",(0,r.jsx)(n.h3,{id:"pr\xe9requis",children:"Pr\xe9requis"}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"cloudflared"})," install\xe9 sur ton PC"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Fichier SSH config"})," configur\xe9"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Email autoris\xe9"})," dans Cloudflare Access"]}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"installation-cloudflared",children:"Installation cloudflared"}),"\n",(0,r.jsx)(n.h4,{id:"windows",children:"Windows"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"T\xe9l\xe9chargement"})," :"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://github.com/cloudflare/cloudflared/releases/latest",children:"https://github.com/cloudflare/cloudflared/releases/latest"})}),"\n",(0,r.jsxs)(n.li,{children:["T\xe9l\xe9charge : ",(0,r.jsx)(n.code,{children:"cloudflared-windows-amd64.exe"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Installation"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-powershell",children:'# Cr\xe9er le dossier\nNew-Item -ItemType Directory -Force -Path "C:\\Program Files\\cloudflared"\n\n# D\xe9placer le fichier t\xe9l\xe9charg\xe9\nMove-Item "$env:USERPROFILE\\Downloads\\cloudflared-windows-amd64.exe" "C:\\Program Files\\cloudflared\\cloudflared.exe"\n\n# V\xe9rifier\n& "C:\\Program Files\\cloudflared\\cloudflared.exe" --version\n'})}),"\n",(0,r.jsx)(n.h4,{id:"linux--macos",children:"Linux / macOS"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Linux\ncurl -L https://github.com/cloudflare/cloudflared/releases/latest/download/cloudflared-linux-amd64 -o /usr/local/bin/cloudflared\nchmod +x /usr/local/bin/cloudflared\n\n# macOS\nbrew install cloudflared\n\n# V\xe9rifier\ncloudflared --version\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"configuration-ssh",children:"Configuration SSH"}),"\n",(0,r.jsx)(n.h4,{id:"windows-1",children:"Windows"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cr\xe9er/\xe9diter le fichier config"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-powershell",children:'# Cr\xe9er le dossier .ssh si inexistant\nNew-Item -ItemType Directory -Force -Path "$env:USERPROFILE\\.ssh"\n\n# \xc9diter avec Notepad\nnotepad "$env:USERPROFILE\\.ssh\\config"\n'})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Contenu"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Host ssh-proxmox\n    HostName ssh-proxmox.olympus-lab.org\n    User root\n    ProxyCommand C:\\PROGRA~1\\cloudflared\\cloudflared.exe access ssh --hostname ssh-proxmox.olympus-lab.org\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Important"})," : ",(0,r.jsx)(n.code,{children:"C:\\PROGRA~1\\"})," est le chemin court pour ",(0,r.jsx)(n.code,{children:"C:\\Program Files\\"}),". Les espaces posent probl\xe8me dans ProxyCommand."]}),"\n",(0,r.jsx)(n.h4,{id:"linux--macos-1",children:"Linux / macOS"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"\xc9diter"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"nano ~/.ssh/config\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Contenu"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Host ssh-proxmox\n    HostName ssh-proxmox.olympus-lab.org\n    User root\n    ProxyCommand /usr/local/bin/cloudflared access ssh --hostname ssh-proxmox.olympus-lab.org\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"utilisation-ssh",children:"Utilisation SSH"}),"\n",(0,r.jsx)(n.h4,{id:"premi\xe8re-connexion",children:"Premi\xe8re connexion"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh ssh-proxmox\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Ce qui se passe"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"1. cloudflared se lance\n2. Ouvre ton navigateur automatiquement\n3. Page Cloudflare Access\n4. Entre ton email\n5. Code envoy\xe9 par email\n6. Entre le code\n7. Authentification r\xe9ussie\n8. Connexion SSH \xe9tablie \u2705\n"})}),"\n",(0,r.jsx)(n.h4,{id:"connexions-suivantes",children:"Connexions suivantes"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh ssh-proxmox\n"})}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Pas besoin de r\xe9-authentification (cookie valide 24h)"}),"\n",(0,r.jsx)(n.li,{children:"Connexion directe"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"ajouter-dautres-machines-ssh",children:"Ajouter d'autres machines SSH"}),"\n",(0,r.jsx)(n.h4,{id:"exemple--ajouter-une-vm-gitlab",children:"Exemple : Ajouter une VM GitLab"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"1. Dans le container hermes (CT 202)"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# \xc9diter la config tunnel\npct enter 202\nnano /etc/cloudflared/config.yml\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Ajouter"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-yaml",children:"  - hostname: ssh-gitlab.olympus-lab.org\n    service: ssh://10.0.1.100:22\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Red\xe9marrer"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"systemctl restart cloudflared\nexit\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"2. Cr\xe9er le DNS"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"pct exec 202 -- cloudflared tunnel route dns opnsense-access ssh-gitlab.olympus-lab.org\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"3. Cr\xe9er l'application Cloudflare Access"})," :"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.a,{href:"https://one.dash.cloudflare.com/",children:"https://one.dash.cloudflare.com/"})," \u2192 ",(0,r.jsx)(n.strong,{children:"Access"})," \u2192 ",(0,r.jsx)(n.strong,{children:"Applications"})," \u2192 ",(0,r.jsx)(n.strong,{children:"Add"})]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Type : Self-hosted"}),"\n",(0,r.jsx)(n.li,{children:"Name : SSH GitLab"}),"\n",(0,r.jsx)(n.li,{children:"Domain : ssh-gitlab.olympus-lab.org"}),"\n",(0,r.jsx)(n.li,{children:"Policy : Allow ton email"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"4. Ajouter dans ton fichier SSH config"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"Host ssh-gitlab\n    HostName ssh-gitlab.olympus-lab.org\n    User root\n    ProxyCommand C:\\PROGRA~1\\cloudflared\\cloudflared.exe access ssh --hostname ssh-gitlab.olympus-lab.org\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"5. Se connecter"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"ssh ssh-gitlab\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h3,{id:"troubleshooting-ssh",children:"Troubleshooting SSH"}),"\n",(0,r.jsx)(n.h4,{id:"could-not-resolve-hostname",children:'"Could not resolve hostname"'}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Erreur"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"ssh: Could not resolve hostname ssh-proxmox: H\xf4te inconnu\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"})," : Le fichier ",(0,r.jsx)(n.code,{children:"~/.ssh/config"})," n'existe pas ou est mal configur\xe9"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"})," :"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"V\xe9rifier que le fichier existe"}),"\n",(0,r.jsx)(n.li,{children:"V\xe9rifier la syntaxe (indentation, pas de tabs)"}),"\n",(0,r.jsxs)(n.li,{children:["V\xe9rifier que ",(0,r.jsx)(n.code,{children:"Host"})," correspond au nom utilis\xe9 dans la commande ssh"]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"permission-denied-publickey",children:'"Permission denied (publickey)"'}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cause"})," : Cloudflare Access fonctionne, mais l'authentification SSH \xe9choue"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solutions"})," :"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"V\xe9rifier le mot de passe"}),"\n",(0,r.jsxs)(n.li,{children:["V\xe9rifier que l'user est correct (",(0,r.jsx)(n.code,{children:"root"})," pour Proxmox)"]}),"\n",(0,r.jsx)(n.li,{children:"Ajouter une cl\xe9 SSH si n\xe9cessaire"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"cloudflared-non-trouv\xe9",children:"cloudflared non trouv\xe9"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Erreur"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"ProxyCommand: command not found: cloudflared\n"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution"})," :"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:["V\xe9rifier que cloudflared est install\xe9 : ",(0,r.jsx)(n.code,{children:"cloudflared --version"})]}),"\n",(0,r.jsx)(n.li,{children:"V\xe9rifier le chemin dans ProxyCommand"}),"\n",(0,r.jsxs)(n.li,{children:["Windows : utiliser ",(0,r.jsx)(n.code,{children:"C:\\PROGRA~1\\"})," au lieu de ",(0,r.jsx)(n.code,{children:"C:\\Program Files\\"})]}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"navigateur-ne-souvre-pas-pour-lauthentification",children:"Navigateur ne s'ouvre pas pour l'authentification"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Solution manuelle"})," :"]}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{className:"language-bash",children:"# Ouvrir manuellement dans le navigateur\nhttps://ssh-proxmox.olympus-lab.org\n\n# S'authentifier\n# Puis retry la commande SSH\nssh ssh-proxmox\n"})}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"acc\xe8s-depuis-diff\xe9rents-appareils",children:"Acc\xe8s depuis diff\xe9rents appareils"}),"\n",(0,r.jsx)(n.h3,{id:"laptop-personnel",children:"Laptop personnel"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Setup"})," :"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:"Installer cloudflared"}),"\n",(0,r.jsx)(n.li,{children:"Configurer SSH config"}),"\n",(0,r.jsx)(n.li,{children:"Utiliser normalement"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"pc-du-travail-si-autoris\xe9",children:"PC du travail (si autoris\xe9)"}),"\n",(0,r.jsx)(n.p,{children:(0,r.jsx)(n.strong,{children:"M\xeame setup que laptop personnel"})}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Attention"})," : V\xe9rifier la politique de l'entreprise concernant les connexions SSH externes."]}),"\n",(0,r.jsx)(n.h3,{id:"t\xe9l\xe9phonetablette",children:"T\xe9l\xe9phone/Tablette"}),"\n",(0,r.jsx)(n.h4,{id:"option-1--interface-web",children:"Option 1 : Interface Web"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Safari/Chrome sur iOS/Android"}),"\n",(0,r.jsxs)(n.li,{children:["Ouvrir ",(0,r.jsx)(n.a,{href:"https://proxmox.olympus-lab.org",children:"https://proxmox.olympus-lab.org"})]}),"\n",(0,r.jsx)(n.li,{children:"Authentification Cloudflare Access"}),"\n",(0,r.jsx)(n.li,{children:"Interface responsive"}),"\n"]}),"\n",(0,r.jsx)(n.h4,{id:"option-2--app-ssh-termius-juicessh",children:"Option 2 : App SSH (Termius, JuiceSSH)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Pas directement support\xe9"})," car cloudflared n'est pas disponible sur mobile."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Alternative"})," : Utiliser un jump host ou VPN."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"sc\xe9narios-dusage",children:"Sc\xe9narios d'usage"}),"\n",(0,r.jsx)(n.h3,{id:"sc\xe9nario-1--chez-tes-parents-en-d\xe9cembre",children:"Sc\xe9nario 1 : Chez tes parents en d\xe9cembre"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"1. Ouvrir le laptop\n2. Connexion WiFi des parents\n3. ssh ssh-proxmox (fonctionne imm\xe9diatement)\n4. OU navigateur \u2192 https://proxmox.olympus-lab.org\n5. G\xe9rer ton homelab normalement \u2705\n"})}),"\n",(0,r.jsx)(n.h3,{id:"sc\xe9nario-2--urgence-depuis-le-t\xe9l\xe9phone",children:"Sc\xe9nario 2 : Urgence depuis le t\xe9l\xe9phone"}),"\n",(0,r.jsx)(n.pre,{children:(0,r.jsx)(n.code,{children:"1. Navigateur mobile\n2. https://proxmox.olympus-lab.org\n3. Authentification Cloudflare\n4. Red\xe9marrer une VM\n5. V\xe9rifier les logs\n"})}),"\n",(0,r.jsx)(n.h3,{id:"sc\xe9nario-3--depuis-un-r\xe9seau-restrictif-entreprise-\xe9cole",children:"Sc\xe9nario 3 : Depuis un r\xe9seau restrictif (entreprise, \xe9cole)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cloudflare Tunnel fonctionne sur le port 443 (HTTPS)"}),", donc passe g\xe9n\xe9ralement \xe0 travers les firewalls d'entreprise."]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Si bloqu\xe9"})," :"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Essayer en 4G/5G (hotspot)"}),"\n",(0,r.jsx)(n.li,{children:"Utiliser un VPN personnel si autoris\xe9"}),"\n"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"s\xe9curit\xe9-de-lacc\xe8s-distant",children:"S\xe9curit\xe9 de l'acc\xe8s distant"}),"\n",(0,r.jsx)(n.h3,{id:"authentification-multi-facteurs",children:"Authentification multi-facteurs"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cloudflare Access"})," : Email + code OTP (d\xe9j\xe0 2FA)"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Recommandation"})," : Activer aussi 2FA sur :"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"OPNsense"})," : System \u2192 Access \u2192 Servers \u2192 Google Authenticator"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Proxmox"})," : Datacenter \u2192 Users \u2192 [user] \u2192 TFA"]}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"bonnes-pratiques",children:"Bonnes pratiques"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Utiliser des mots de passe forts (20+ caract\xe8res)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Ne jamais partager les credentials"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 V\xe9rifier les logs r\xe9guli\xe8rement (Cloudflare Dashboard)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 R\xe9voquer l'acc\xe8s imm\xe9diatement en cas de perte d'appareil"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Session timeout : 24h maximum"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"r\xe9voquer-un-acc\xe8s",children:"R\xe9voquer un acc\xe8s"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cloudflare Dashboard"})," :"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://one.dash.cloudflare.com/",children:"https://one.dash.cloudflare.com/"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Access"})," \u2192 ",(0,r.jsx)(n.strong,{children:"Applications"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Edit"})," l'application"]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Policies"})," \u2192 Retirer l'email"]}),"\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.strong,{children:"Save"})}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Imm\xe9diat"})," : L'utilisateur perd l'acc\xe8s imm\xe9diatement."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"monitoring-des-connexions",children:"Monitoring des connexions"}),"\n",(0,r.jsx)(n.h3,{id:"voir-qui-se-connecte",children:"Voir qui se connecte"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Cloudflare Dashboard"})," :"]}),"\n",(0,r.jsxs)(n.ol,{children:["\n",(0,r.jsx)(n.li,{children:(0,r.jsx)(n.a,{href:"https://one.dash.cloudflare.com/",children:"https://one.dash.cloudflare.com/"})}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Logs"})," \u2192 ",(0,r.jsx)(n.strong,{children:"Access"})]}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Informations"})," :"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Timestamp"}),"\n",(0,r.jsx)(n.li,{children:"Email utilis\xe9"}),"\n",(0,r.jsx)(n.li,{children:"Application acc\xe9d\xe9e"}),"\n",(0,r.jsx)(n.li,{children:"IP source"}),"\n",(0,r.jsx)(n.li,{children:"User agent (navigateur)"}),"\n",(0,r.jsx)(n.li,{children:"Succ\xe8s/\xe9chec"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"alertes",children:"Alertes"}),"\n",(0,r.jsx)(n.p,{children:"Cloudflare peut envoyer des alertes par email en cas de :"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Tentatives d'acc\xe8s refus\xe9es"}),"\n",(0,r.jsx)(n.li,{children:"Acc\xe8s depuis un nouveau pays"}),"\n",(0,r.jsx)(n.li,{children:"Pattern suspect"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Configuration"})," : Dashboard \u2192 Notifications"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"co\xfbts",children:"Co\xfbts"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Tous les acc\xe8s d\xe9crits ici sont GRATUITS"})," :"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"\u2705 Cloudflare Tunnel : Gratuit"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Cloudflare Access : Gratuit (jusqu'\xe0 50 utilisateurs)"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 DNS Cloudflare : Gratuit"}),"\n",(0,r.jsx)(n.li,{children:"\u2705 Certificats SSL : Gratuits (auto-g\xe9n\xe9r\xe9s)"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Seul co\xfbt"})," : Domaine olympus-lab.org (~12\u20ac/an)"]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"alternatives",children:"Alternatives"}),"\n",(0,r.jsx)(n.h3,{id:"wireguard-vpn-non-impl\xe9ment\xe9",children:"WireGuard VPN (non impl\xe9ment\xe9)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Avantages"})," :"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Acc\xe8s complet au r\xe9seau (pas seulement web/SSH)"}),"\n",(0,r.jsx)(n.li,{children:"Plus rapide (pas de proxy)"}),"\n",(0,r.jsx)(n.li,{children:"Peut acc\xe9der aux services non-HTTP"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Inconv\xe9nients"})," :"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"N\xe9cessite port forwarding (s\xe9curit\xe9 moindre)"}),"\n",(0,r.jsx)(n.li,{children:"Configuration plus complexe"}),"\n",(0,r.jsx)(n.li,{children:"Pas de logs centralis\xe9s"}),"\n"]}),"\n",(0,r.jsx)(n.h3,{id:"tailscale-test\xe9-non-fonctionnel-pour-subnet-routing",children:"Tailscale (test\xe9, non fonctionnel pour subnet routing)"}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Avantages"})," :"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"Z\xe9ro configuration"}),"\n",(0,r.jsx)(n.li,{children:"Mesh VPN"}),"\n",(0,r.jsx)(n.li,{children:"Pas de port forwarding"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Inconv\xe9nients"})," :"]}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsx)(n.li,{children:"N\xe9cessite Tailscale sur chaque machine"}),"\n",(0,r.jsx)(n.li,{children:"Subnet routing probl\xe9matique dans notre setup"}),"\n"]}),"\n",(0,r.jsxs)(n.p,{children:[(0,r.jsx)(n.strong,{children:"Choix actuel"})," : Cloudflare Tunnel = meilleur compromis simplicit\xe9/s\xe9curit\xe9."]}),"\n",(0,r.jsx)(n.hr,{}),"\n",(0,r.jsx)(n.h2,{id:"ressources",children:"Ressources"}),"\n",(0,r.jsxs)(n.ul,{children:["\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"Cloudflare Access Docs"})," : ",(0,r.jsx)(n.a,{href:"https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/",children:"https://developers.cloudflare.com/cloudflare-one/applications/configure-apps/"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"SSH Config Guide"})," : ",(0,r.jsx)(n.a,{href:"https://www.ssh.com/academy/ssh/config",children:"https://www.ssh.com/academy/ssh/config"})]}),"\n",(0,r.jsxs)(n.li,{children:[(0,r.jsx)(n.strong,{children:"cloudflared GitHub"})," : ",(0,r.jsx)(n.a,{href:"https://github.com/cloudflare/cloudflared",children:"https://github.com/cloudflare/cloudflared"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,r.jsx)(n,{...e,children:(0,r.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>o,x:()=>c});var i=s(6540);const r={},l=i.createContext(r);function o(e){const n=i.useContext(l);return i.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function c(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(r):e.components||r:o(e.components),i.createElement(l.Provider,{value:n},e.children)}}}]);