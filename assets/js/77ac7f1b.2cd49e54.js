"use strict";(globalThis.webpackChunkhomelab_docs=globalThis.webpackChunkhomelab_docs||[]).push([[427],{4329:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>d});const r=JSON.parse('{"id":"homelab/security/firewall-rules","title":"R\xe8gles Firewall d\xe9taill\xe9es","description":"Configuration compl\xe8te des r\xe8gles de s\xe9curit\xe9 OPNsense pour l\'infrastructure Olympus Lab.","source":"@site/docs/homelab/security/firewall-rules.md","sourceDirName":"homelab/security","slug":"/homelab/security/firewall-rules","permalink":"/docs/homelab/security/firewall-rules","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/homelab/security/firewall-rules.md","tags":[],"version":"current","sidebarPosition":1,"frontMatter":{"sidebar_position":1},"sidebar":"tutorialSidebar","previous":{"title":"Architecture R\xe9seau","permalink":"/docs/homelab/infrastructure/network"},"next":{"title":"\ud83d\udc33 Docker Containers","permalink":"/docs/homelab/services/docker-containers"}}');var i=s(4848),l=s(8453);const t={sidebar_position:1},o="R\xe8gles Firewall d\xe9taill\xe9es",c={},d=[{value:"Philosophie de s\xe9curit\xe9",id:"philosophie-de-s\xe9curit\xe9",level:2},{value:"Defense in Depth (D\xe9fense en profondeur)",id:"defense-in-depth-d\xe9fense-en-profondeur",level:3},{value:"Principes appliqu\xe9s",id:"principes-appliqu\xe9s",level:3},{value:"Segmentation r\xe9seau",id:"segmentation-r\xe9seau",level:2},{value:"Zones de s\xe9curit\xe9",id:"zones-de-s\xe9curit\xe9",level:3},{value:"Matrice de communication",id:"matrice-de-communication",level:3},{value:"R\xe8gles d\xe9taill\xe9es par interface",id:"r\xe8gles-d\xe9taill\xe9es-par-interface",level:2},{value:"LAN (10.0.1.0/24) - Production",id:"lan-1001024---production",level:3},{value:"R\xe8gle 1 : Allow LAN internal communication",id:"r\xe8gle-1--allow-lan-internal-communication",level:4},{value:"R\xe8gle 2 : Block LAN to other private networks",id:"r\xe8gle-2--block-lan-to-other-private-networks",level:4},{value:"R\xe8gle 3 : Allow LAN to Internet",id:"r\xe8gle-3--allow-lan-to-internet",level:4},{value:"DMZ (10.0.2.0/24) - Services expos\xe9s",id:"dmz-1002024---services-expos\xe9s",level:3},{value:"R\xe8gle 1 : Block DMZ to RFC1918 (private networks)",id:"r\xe8gle-1--block-dmz-to-rfc1918-private-networks",level:4},{value:"R\xe8gle 2 : Allow DMZ to Internet",id:"r\xe8gle-2--allow-dmz-to-internet",level:4},{value:"DEV (10.0.3.0/24) - D\xe9veloppement",id:"dev-1003024---d\xe9veloppement",level:3},{value:"R\xe8gle 1 : Block DEV to RFC1918",id:"r\xe8gle-1--block-dev-to-rfc1918",level:4},{value:"R\xe8gle 2 : Allow DEV to Internet",id:"r\xe8gle-2--allow-dev-to-internet",level:4},{value:"MGMT (10.0.4.0/24) - Administration",id:"mgmt-1004024---administration",level:3},{value:"R\xe8gle 1 : Allow MGMT to anywhere",id:"r\xe8gle-1--allow-mgmt-to-anywhere",level:4},{value:"Concepts avanc\xe9s",id:"concepts-avanc\xe9s",level:2},{value:"Stateful Firewall",id:"stateful-firewall",level:3},{value:"NAT (Network Address Translation)",id:"nat-network-address-translation",level:3},{value:"Default Deny",id:"default-deny",level:3},{value:"Cas d&#39;usage pratiques",id:"cas-dusage-pratiques",level:2},{value:"Sc\xe9nario 1 : Serveur web en DMZ qui a besoin d&#39;une base de donn\xe9es en LAN",id:"sc\xe9nario-1--serveur-web-en-dmz-qui-a-besoin-dune-base-de-donn\xe9es-en-lan",level:3},{value:"Option A : Reverse Proxy avec API Gateway",id:"option-a--reverse-proxy-avec-api-gateway",level:4},{value:"Option B : R\xe8gle firewall sp\xe9cifique",id:"option-b--r\xe8gle-firewall-sp\xe9cifique",level:4},{value:"Sc\xe9nario 2 : Jump Host en MGMT pour administrer le LAN",id:"sc\xe9nario-2--jump-host-en-mgmt-pour-administrer-le-lan",level:3},{value:"Sc\xe9nario 3 : Environnement DEV isol\xe9",id:"sc\xe9nario-3--environnement-dev-isol\xe9",level:3},{value:"Monitoring et logs",id:"monitoring-et-logs",level:2},{value:"Activer le logging",id:"activer-le-logging",level:3},{value:"Voir les logs",id:"voir-les-logs",level:3},{value:"R\xe8gles \xe0 NE PAS faire",id:"r\xe8gles-\xe0-ne-pas-faire",level:2},{value:"\u274c Allow any \u2192 any",id:"-allow-any--any",level:3},{value:"\u274c DMZ \u2192 LAN autoris\xe9",id:"-dmz--lan-autoris\xe9",level:3},{value:"\u274c R\xe8gles trop larges",id:"-r\xe8gles-trop-larges",level:3},{value:"Best Practices",id:"best-practices",level:2},{value:"\u2705 Principe du moindre privil\xe8ge",id:"-principe-du-moindre-privil\xe8ge",level:3},{value:"\u2705 Documentation",id:"-documentation",level:3},{value:"\u2705 Review r\xe9gulier",id:"-review-r\xe9gulier",level:3},{value:"\u2705 Logging",id:"-logging",level:3},{value:"\u2705 Testing",id:"-testing",level:3},{value:"\xc9volutions futures",id:"\xe9volutions-futures",level:2},{value:"Port Forwarding (quand n\xe9cessaire)",id:"port-forwarding-quand-n\xe9cessaire",level:3},{value:"VPN (WireGuard)",id:"vpn-wireguard",level:3},{value:"IDS/IPS (Suricata)",id:"idsips-suricata",level:3},{value:"Ressources",id:"ressources",level:2}];function a(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"r\xe8gles-firewall-d\xe9taill\xe9es",children:"R\xe8gles Firewall d\xe9taill\xe9es"})}),"\n",(0,i.jsx)(n.p,{children:"Configuration compl\xe8te des r\xe8gles de s\xe9curit\xe9 OPNsense pour l'infrastructure Olympus Lab."}),"\n",(0,i.jsx)(n.h2,{id:"philosophie-de-s\xe9curit\xe9",children:"Philosophie de s\xe9curit\xe9"}),"\n",(0,i.jsx)(n.h3,{id:"defense-in-depth-d\xe9fense-en-profondeur",children:"Defense in Depth (D\xe9fense en profondeur)"}),"\n",(0,i.jsx)(n.p,{children:"Plusieurs couches de s\xe9curit\xe9 :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"1. Cloudflare Edge (DDoS, WAF)\n    \u2193\n2. Cloudflare Access (Authentication)\n    \u2193\n3. Cloudflare Tunnel (Encryption)\n    \u2193\n4. OPNsense Firewall (Network Segmentation)\n    \u2193\n5. Application-level security (2FA, ACLs)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"principes-appliqu\xe9s",children:"Principes appliqu\xe9s"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Default Deny"})," : Tout est bloqu\xe9 par d\xe9faut, autorisation explicite n\xe9cessaire"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Least Privilege"})," : Chaque r\xe9seau/syst\xe8me a le minimum d'acc\xe8s n\xe9cessaire"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Network Segmentation"})," : Isolation des zones selon leur niveau de confiance"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Zero Trust"})," : Ne jamais faire confiance, toujours v\xe9rifier"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"segmentation-r\xe9seau",children:"Segmentation r\xe9seau"}),"\n",(0,i.jsx)(n.h3,{id:"zones-de-s\xe9curit\xe9",children:"Zones de s\xe9curit\xe9"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         NIVEAU DE CONFIANCE                  \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 HIGH    \u2502 MGMT (10.0.4.0/24)                \u2502\n\u2502         \u2502 Administration compl\xe8te            \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 MEDIUM  \u2502 LAN (10.0.1.0/24)                 \u2502\n\u2502         \u2502 Production, services internes      \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 LOW     \u2502 DEV (10.0.3.0/24)                 \u2502\n\u2502         \u2502 D\xe9veloppement, tests               \u2502\n\u251c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u253c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2524\n\u2502 UNTRUST \u2502 DMZ (10.0.2.0/24)                 \u2502\n\u2502         \u2502 Services expos\xe9s publiquement      \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.h3,{id:"matrice-de-communication",children:"Matrice de communication"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Source \u2193 Dest \u2192"}),(0,i.jsx)(n.th,{children:"Internet"}),(0,i.jsx)(n.th,{children:"LAN"}),(0,i.jsx)(n.th,{children:"DMZ"}),(0,i.jsx)(n.th,{children:"DEV"}),(0,i.jsx)(n.th,{children:"MGMT"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"LAN"})}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u274c"}),(0,i.jsx)(n.td,{children:"\u274c"}),(0,i.jsx)(n.td,{children:"\u274c"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"DMZ"})}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u274c"}),(0,i.jsx)(n.td,{children:"\u274c"}),(0,i.jsx)(n.td,{children:"\u274c"}),(0,i.jsx)(n.td,{children:"\u274c"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"DEV"})}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u274c"}),(0,i.jsx)(n.td,{children:"\u274c"}),(0,i.jsx)(n.td,{children:"\u274c"}),(0,i.jsx)(n.td,{children:"\u274c"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:(0,i.jsx)(n.strong,{children:"MGMT"})}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"}),(0,i.jsx)(n.td,{children:"\u2705"})]})]})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"r\xe8gles-d\xe9taill\xe9es-par-interface",children:"R\xe8gles d\xe9taill\xe9es par interface"}),"\n",(0,i.jsx)(n.h3,{id:"lan-1001024---production",children:"LAN (10.0.1.0/24) - Production"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cas d'usage"})," : Services de production, VMs principales, containers critiques"]}),"\n",(0,i.jsx)(n.h4,{id:"r\xe8gle-1--allow-lan-internal-communication",children:"R\xe8gle 1 : Allow LAN internal communication"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Action: Pass\nInterface: LAN\nProtocol: any\nSource: LAN net (10.0.1.0/24)\nDestination: LAN net (10.0.1.0/24)\nDescription: Allow LAN internal communications\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Justification"})," : Les machines en LAN doivent pouvoir communiquer entre elles (ex: serveur web \u2192 base de donn\xe9es)."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Services autoris\xe9s"})," :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"SSH inter-VM"}),"\n",(0,i.jsx)(n.li,{children:"Bases de donn\xe9es"}),"\n",(0,i.jsx)(n.li,{children:"APIs internes"}),"\n",(0,i.jsx)(n.li,{children:"File sharing (NFS, SMB)"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"r\xe8gle-2--block-lan-to-other-private-networks",children:"R\xe8gle 2 : Block LAN to other private networks"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Action: Block\nInterface: LAN\nProtocol: any\nSource: LAN net (10.0.1.0/24)\nDestination: 10.0.0.0/8\nLog: Yes\nDescription: Block LAN to other internal networks\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Justification"})," : Le LAN ne doit PAS pouvoir acc\xe9der \xe0 :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"DMZ (10.0.2.0/24) : isolation des services expos\xe9s"}),"\n",(0,i.jsx)(n.li,{children:"DEV (10.0.3.0/24) : isolation de l'environnement de test"}),"\n",(0,i.jsx)(n.li,{children:"MGMT (10.0.4.0/24) : isolation de l'administration"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Pourquoi"})," : Si une VM en LAN est compromise, l'attaquant ne peut pas rebondir vers les autres r\xe9seaux."]}),"\n",(0,i.jsx)(n.h4,{id:"r\xe8gle-3--allow-lan-to-internet",children:"R\xe8gle 3 : Allow LAN to Internet"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Action: Pass\nInterface: LAN\nProtocol: any\nSource: LAN net (10.0.1.0/24)\nDestination: any\nDescription: Allow LAN to Internet\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Justification"})," : Les services de production ont besoin d'acc\xe9der \xe0 Internet pour :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Mises \xe0 jour (apt, yum)"}),"\n",(0,i.jsx)(n.li,{children:"APIs externes"}),"\n",(0,i.jsx)(n.li,{children:"Services cloud"}),"\n",(0,i.jsx)(n.li,{children:"T\xe9l\xe9chargements"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"dmz-1002024---services-expos\xe9s",children:"DMZ (10.0.2.0/24) - Services expos\xe9s"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cas d'usage"})," : Serveurs web, reverse proxy, services accessibles publiquement"]}),"\n",(0,i.jsx)(n.h4,{id:"r\xe8gle-1--block-dmz-to-rfc1918-private-networks",children:"R\xe8gle 1 : Block DMZ to RFC1918 (private networks)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Action: Block\nInterface: DMZ\nProtocol: any\nSource: DMZ net (10.0.2.0/24)\nDestination: 10.0.0.0/8\nLog: Yes\nDescription: Block DMZ to private networks - Isolation compl\xe8te\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Justification"})," : ",(0,i.jsx)(n.strong,{children:"CRITIQUE"})," - La DMZ ne doit JAMAIS pouvoir acc\xe9der aux r\xe9seaux internes."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Sc\xe9nario d'attaque bloqu\xe9"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"1. Attaquant compromise un serveur web en DMZ\n2. Tente de scanner le r\xe9seau interne (10.0.1.x)\n3. \u274c BLOQU\xc9 par cette r\xe8gle\n4. L'attaque s'arr\xeate l\xe0\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Ce qui est bloqu\xe9"})," :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u274c DMZ \u2192 LAN (10.0.1.0/24)"}),"\n",(0,i.jsx)(n.li,{children:"\u274c DMZ \u2192 DEV (10.0.3.0/24)"}),"\n",(0,i.jsx)(n.li,{children:"\u274c DMZ \u2192 MGMT (10.0.4.0/24)"}),"\n",(0,i.jsx)(n.li,{children:"\u274c DMZ \u2192 OPNsense (10.0.x.1)"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"r\xe8gle-2--allow-dmz-to-internet",children:"R\xe8gle 2 : Allow DMZ to Internet"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Action: Pass\nInterface: DMZ\nProtocol: any\nSource: DMZ net (10.0.2.0/24)\nDestination: any\nDescription: Allow DMZ to Internet only\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Justification"})," : Les services en DMZ ont besoin d'Internet pour :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Mises \xe0 jour de s\xe9curit\xe9 (critique !)"}),"\n",(0,i.jsx)(n.li,{children:"APIs externes"}),"\n",(0,i.jsx)(n.li,{children:"CDN, services cloud"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Limitations"})," : Acc\xe8s Internet uniquement, ",(0,i.jsx)(n.strong,{children:"rien d'autre"}),"."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"dev-1003024---d\xe9veloppement",children:"DEV (10.0.3.0/24) - D\xe9veloppement"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cas d'usage"})," : Environnement de test, exp\xe9rimentations, VMs jetables"]}),"\n",(0,i.jsx)(n.h4,{id:"r\xe8gle-1--block-dev-to-rfc1918",children:"R\xe8gle 1 : Block DEV to RFC1918"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Action: Block\nInterface: DEV\nProtocol: any\nSource: DEV net (10.0.3.0/24)\nDestination: 10.0.0.0/8\nLog: Yes\nDescription: Block DEV to private networks - Isolation compl\xe8te\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Justification"})," : L'environnement DEV est volatile et moins s\xe9curis\xe9 :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Tests de nouvelles technos"}),"\n",(0,i.jsx)(n.li,{children:"Configurations exp\xe9rimentales"}),"\n",(0,i.jsx)(n.li,{children:"Code non test\xe9"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Protection"})," : Si une VM DEV est compromise (volontairement ou non), elle ne peut pas atteindre la production."]}),"\n",(0,i.jsx)(n.h4,{id:"r\xe8gle-2--allow-dev-to-internet",children:"R\xe8gle 2 : Allow DEV to Internet"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Action: Pass\nInterface: DEV\nProtocol: any\nSource: DEV net (10.0.3.0/24)\nDestination: any\nDescription: Allow DEV to Internet\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Justification"})," : L'environnement DEV a besoin d'Internet pour :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"T\xe9l\xe9charger des outils"}),"\n",(0,i.jsx)(n.li,{children:"Tester des APIs"}),"\n",(0,i.jsx)(n.li,{children:"Installer des packages"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"mgmt-1004024---administration",children:"MGMT (10.0.4.0/24) - Administration"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Cas d'usage"})," : Jump host, Ansible control node, monitoring, outils d'administration"]}),"\n",(0,i.jsx)(n.h4,{id:"r\xe8gle-1--allow-mgmt-to-anywhere",children:"R\xe8gle 1 : Allow MGMT to anywhere"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Action: Pass\nInterface: MGMT\nProtocol: any\nSource: MGMT net (10.0.4.0/24)\nDestination: any\nDescription: Allow MGMT full access for administration\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Justification"})," : Le r\xe9seau MGMT doit pouvoir g\xe9rer TOUTE l'infrastructure :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"SSH vers toutes les VMs"}),"\n",(0,i.jsx)(n.li,{children:"Acc\xe8s aux interfaces web (Proxmox, OPNsense)"}),"\n",(0,i.jsx)(n.li,{children:"D\xe9ploiement Ansible"}),"\n",(0,i.jsx)(n.li,{children:"Monitoring Prometheus/Grafana"}),"\n",(0,i.jsx)(n.li,{children:"Backups"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"S\xe9curit\xe9"})," : Acc\xe8s restreint, authentification forte requise, machines hautement s\xe9curis\xe9es."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"concepts-avanc\xe9s",children:"Concepts avanc\xe9s"}),"\n",(0,i.jsx)(n.h3,{id:"stateful-firewall",children:"Stateful Firewall"}),"\n",(0,i.jsxs)(n.p,{children:["OPNsense utilise ",(0,i.jsx)(n.strong,{children:"pf"})," (Packet Filter) de FreeBSD, qui est ",(0,i.jsx)(n.strong,{children:"stateful"}),"."]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Qu'est-ce que \xe7a veut dire ?"})}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'Client (10.0.1.50) \u2192 Server web externe (1.2.3.4:443)\n    \u2193\n1. Client envoie SYN \u2192 Firewall cr\xe9e un "state"\n2. Server r\xe9pond SYN-ACK \u2192 Firewall autorise automatiquement (state existant)\n3. Client envoie ACK \u2192 Autoris\xe9\n4. Donn\xe9es \xe9chang\xe9es \u2192 Autoris\xe9es\n5. Connexion ferm\xe9e \u2192 State supprim\xe9\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Avantage"}),' : Pas besoin de r\xe8gle "Allow Internet \u2192 LAN" pour les r\xe9ponses. Le firewall se souvient des connexions sortantes et autorise automatiquement les r\xe9ponses.']}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"nat-network-address-translation",children:"NAT (Network Address Translation)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Mode"})," : Automatic Outbound NAT"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Fonctionnement"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"VM LAN (10.0.1.50) veut acc\xe9der \xe0 google.com\n    \u2193\n1. Paquet : 10.0.1.50:12345 \u2192 142.250.x.x:443\n2. OPNsense traduit : IP_PUBLIQUE:54321 \u2192 142.250.x.x:443\n3. R\xe9ponse : 142.250.x.x:443 \u2192 IP_PUBLIQUE:54321\n4. OPNsense retraduit : 142.250.x.x:443 \u2192 10.0.1.50:12345\n5. VM re\xe7oit la r\xe9ponse\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"R\xe9sultat"})," : Une seule IP publique pour tous les r\xe9seaux internes."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"default-deny",children:"Default Deny"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Par d\xe9faut, TOUT est bloqu\xe9."})}),"\n",(0,i.jsxs)(n.p,{children:["Si tu ne cr\xe9es PAS de r\xe8gle explicite, le trafic est ",(0,i.jsx)(n.strong,{children:"rejet\xe9"}),"."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Exemple"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'Machine en LAN (10.0.1.50) essaie de contacter DMZ (10.0.2.10)\n    \u2193\nPas de r\xe8gle "Allow LAN \u2192 DMZ"\n    \u2193\n\u274c BLOQU\xc9 par d\xe9faut\n    \u2193\nAppara\xeet dans les logs comme "Default deny"\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Avantage"})," : S\xe9curit\xe9 maximale, pas de surprise."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"cas-dusage-pratiques",children:"Cas d'usage pratiques"}),"\n",(0,i.jsx)(n.h3,{id:"sc\xe9nario-1--serveur-web-en-dmz-qui-a-besoin-dune-base-de-donn\xe9es-en-lan",children:"Sc\xe9nario 1 : Serveur web en DMZ qui a besoin d'une base de donn\xe9es en LAN"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Probl\xe8me"})," : DMZ ne peut pas acc\xe9der au LAN par design."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Solutions"})," :"]}),"\n",(0,i.jsx)(n.h4,{id:"option-a--reverse-proxy-avec-api-gateway",children:"Option A : Reverse Proxy avec API Gateway"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Client \u2192 DMZ (Nginx reverse proxy)\n         \u2193\n         API Gateway en LAN\n         \u2193\n         Base de donn\xe9es en LAN\n"})}),"\n",(0,i.jsx)(n.p,{children:"Le reverse proxy en DMZ expose une API. L'API Gateway en LAN g\xe8re les requ\xeates."}),"\n",(0,i.jsx)(n.h4,{id:"option-b--r\xe8gle-firewall-sp\xe9cifique",children:"Option B : R\xe8gle firewall sp\xe9cifique"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Action: Pass\nInterface: DMZ\nProtocol: TCP\nSource: DMZ net (10.0.2.0/24)\nDestination: 10.0.1.100 (serveur DB)\nDestination Port: 5432 (PostgreSQL)\nDescription: Allow DMZ web server to DB only\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Principe"})," : Autorisation tr\xe8s sp\xe9cifique (1 IP, 1 port), pas d'acc\xe8s g\xe9n\xe9ral."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"sc\xe9nario-2--jump-host-en-mgmt-pour-administrer-le-lan",children:"Sc\xe9nario 2 : Jump Host en MGMT pour administrer le LAN"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Setup"})," :"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Machine admin en MGMT (10.0.4.10)"}),"\n",(0,i.jsx)(n.li,{children:"SSH vers les VMs en LAN via le jump host"}),"\n",(0,i.jsx)(n.li,{children:"Pas d'acc\xe8s SSH direct depuis l'ext\xe9rieur"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Workflow"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Laptop (via VPN) \u2192 Jump Host (10.0.4.10)\n                        \u2193\n                   SSH vers VM LAN (10.0.1.50)\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Avantage"})," : Un seul point d'entr\xe9e s\xe9curis\xe9, logs centralis\xe9s."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h3,{id:"sc\xe9nario-3--environnement-dev-isol\xe9",children:"Sc\xe9nario 3 : Environnement DEV isol\xe9"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Besoin"})," : Tester une nouvelle stack (Docker Swarm, K3s) sans risquer la production."]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Setup"})," :"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Cluster de VMs en DEV (10.0.3.x)"}),"\n",(0,i.jsx)(n.li,{children:"Exp\xe9rimentation libre"}),"\n",(0,i.jsx)(n.li,{children:"Si compromis \u2192 isolation totale, pas d'impact sur LAN"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Protection"}),' : R\xe8gle "Block DEV to RFC1918" emp\xeache toute propagation.']}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"monitoring-et-logs",children:"Monitoring et logs"}),"\n",(0,i.jsx)(n.h3,{id:"activer-le-logging",children:"Activer le logging"}),"\n",(0,i.jsx)(n.p,{children:'Pour toutes les r\xe8gles "Block", activer le logging :'}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Firewall \u2192 Rules \u2192 [Interface] \u2192 Edit Rule\n    \u2193\nLog packets that are handled by this rule: \u2611\n    \u2193\nSave \u2192 Apply\n"})}),"\n",(0,i.jsx)(n.h3,{id:"voir-les-logs",children:"Voir les logs"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Firewall \u2192 Log Files \u2192 Live View"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Informations affich\xe9es"})," :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Timestamp"}),"\n",(0,i.jsx)(n.li,{children:"Action (Pass/Block)"}),"\n",(0,i.jsx)(n.li,{children:"Interface"}),"\n",(0,i.jsx)(n.li,{children:"Protocol"}),"\n",(0,i.jsxs)(n.li,{children:["Source IP",":Port"]}),"\n",(0,i.jsxs)(n.li,{children:["Destination IP",":Port"]}),"\n",(0,i.jsx)(n.li,{children:"Flags TCP"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Exemple de log"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Dec 01 14:23:45  block  DMZ  TCP  10.0.2.50:54321 \u2192 10.0.1.100:22  Flags: S\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Interpr\xe9tation"})," : Une machine en DMZ (10.0.2.50) a tent\xe9 de se connecter en SSH (port 22) vers une machine en LAN (10.0.1.100). \u274c ",(0,i.jsx)(n.strong,{children:"Bloqu\xe9"}),' par la r\xe8gle "Block DMZ to RFC1918".']}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"r\xe8gles-\xe0-ne-pas-faire",children:"R\xe8gles \xe0 NE PAS faire"}),"\n",(0,i.jsx)(n.h3,{id:"-allow-any--any",children:"\u274c Allow any \u2192 any"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Action: Pass\nSource: any\nDestination: any\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Danger"})," : Annule toute la s\xe9curit\xe9. Tout le monde peut acc\xe9der \xe0 tout."]}),"\n",(0,i.jsx)(n.h3,{id:"-dmz--lan-autoris\xe9",children:"\u274c DMZ \u2192 LAN autoris\xe9"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Action: Pass\nInterface: DMZ\nSource: DMZ net\nDestination: LAN net\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Danger"})," : Si un serveur web en DMZ est compromis, l'attaquant peut acc\xe9der \xe0 la production."]}),"\n",(0,i.jsx)(n.h3,{id:"-r\xe8gles-trop-larges",children:"\u274c R\xe8gles trop larges"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Action: Pass\nProtocol: any\nSource: any\nDestination: Serveur important\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Probl\xe8me"})," : N'importe qui peut acc\xe9der. Toujours restreindre la source."]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"best-practices",children:"Best Practices"}),"\n",(0,i.jsx)(n.h3,{id:"-principe-du-moindre-privil\xe8ge",children:"\u2705 Principe du moindre privil\xe8ge"}),"\n",(0,i.jsx)(n.p,{children:"Chaque r\xe8gle doit \xeatre la plus sp\xe9cifique possible :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"IP source pr\xe9cise (ou r\xe9seau)"}),"\n",(0,i.jsx)(n.li,{children:"IP destination pr\xe9cise"}),"\n",(0,i.jsx)(n.li,{children:"Ports sp\xe9cifiques"}),"\n",(0,i.jsx)(n.li,{children:"Protocole sp\xe9cifique"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"-documentation",children:"\u2705 Documentation"}),"\n",(0,i.jsx)(n.p,{children:"Chaque r\xe8gle doit avoir une description claire :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:'\u2705 "Allow web server in DMZ to PostgreSQL in LAN (10.0.1.100:5432)"\n\u274c "Allow DMZ to LAN"\n'})}),"\n",(0,i.jsx)(n.h3,{id:"-review-r\xe9gulier",children:"\u2705 Review r\xe9gulier"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Mensuel"})," : V\xe9rifier les r\xe8gles, supprimer celles qui ne servent plus"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Apr\xe8s incident"})," : Analyser les logs, ajuster les r\xe8gles"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"-logging",children:"\u2705 Logging"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:'Activer le logging sur toutes les r\xe8gles "Block"'}),"\n",(0,i.jsx)(n.li,{children:'Optionnel sur les r\xe8gles "Pass" (peut g\xe9n\xe9rer beaucoup de logs)'}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"-testing",children:"\u2705 Testing"}),"\n",(0,i.jsx)(n.p,{children:"Apr\xe8s chaque modification :"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsx)(n.li,{children:"Tester que ce qui doit marcher fonctionne"}),"\n",(0,i.jsx)(n.li,{children:"Tester que ce qui doit \xeatre bloqu\xe9 est bien bloqu\xe9"}),"\n"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Exemple de test depuis une VM en DMZ\nping 10.0.1.1  # Doit \xeatre bloqu\xe9\nping 1.1.1.1   # Doit fonctionner\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\xe9volutions-futures",children:"\xc9volutions futures"}),"\n",(0,i.jsx)(n.h3,{id:"port-forwarding-quand-n\xe9cessaire",children:"Port Forwarding (quand n\xe9cessaire)"}),"\n",(0,i.jsx)(n.p,{children:"Pour exposer un service en DMZ :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Firewall \u2192 NAT \u2192 Port Forward\n\nWAN Interface: WAN\nProtocol: TCP\nDestination: WAN address\nDestination Port: 443\nRedirect Target IP: 10.0.2.50 (serveur web DMZ)\nRedirect Target Port: 443\nDescription: Forward HTTPS to web server\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Avec Cloudflare Tunnel, pas besoin de port forwarding !"})," \u2705"]}),"\n",(0,i.jsx)(n.h3,{id:"vpn-wireguard",children:"VPN (WireGuard)"}),"\n",(0,i.jsx)(n.p,{children:"Pour un acc\xe8s VPN classique (alternative \xe0 Cloudflare Tunnel) :"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"VPN \u2192 Tunnel vers MGMT (10.0.4.0/24)\n    \u2193\nDepuis MGMT, acc\xe8s \xe0 toute l'infra\n"})}),"\n",(0,i.jsx)(n.h3,{id:"idsips-suricata",children:"IDS/IPS (Suricata)"}),"\n",(0,i.jsx)(n.p,{children:"OPNsense peut installer Suricata pour d\xe9tecter les intrusions :"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"System \u2192 Firmware \u2192 Plugins"})," \u2192 Installer ",(0,i.jsx)(n.code,{children:"os-suricata"})]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"ressources",children:"Ressources"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"pf Handbook"})," : ",(0,i.jsx)(n.a,{href:"https://www.openbsd.org/faq/pf/",children:"https://www.openbsd.org/faq/pf/"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"OPNsense Docs"})," : ",(0,i.jsx)(n.a,{href:"https://docs.opnsense.org/manual/firewall.html",children:"https://docs.opnsense.org/manual/firewall.html"})]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"NIST Security Guidelines"})," : ",(0,i.jsx)(n.a,{href:"https://www.nist.gov/cyberframework",children:"https://www.nist.gov/cyberframework"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(a,{...e})}):a(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>o});var r=s(6540);const i={},l=r.createContext(i);function t(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);