"use strict";(globalThis.webpackChunkhomelab_docs=globalThis.webpackChunkhomelab_docs||[]).push([[7124],{2319:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>c,contentTitle:()=>o,default:()=>h,frontMatter:()=>t,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"homelab/services/monitoring","title":"\ud83d\udcca Monitoring","description":"Infrastructure de surveillance compl\xe8te d\'Olympus Lab.","source":"@site/docs/homelab/services/monitoring.md","sourceDirName":"homelab/services","slug":"/homelab/services/monitoring","permalink":"/docs/homelab/services/monitoring","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/homelab/services/monitoring.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"\ud83d\udc33 Docker Containers","permalink":"/docs/homelab/services/docker-containers"},"next":{"title":"Acces Remote","permalink":"/docs/homelab/procedures/access-remote"}}');var i=s(4848),l=s(8453);const t={sidebar_position:2},o="\ud83d\udcca Monitoring",c={},a=[{value:"\ud83c\udfaf Objectifs",id:"-objectifs",level:2},{value:"\ud83d\udcd0 Architecture",id:"-architecture",level:2},{value:"\ud83d\udfe2 Uptime Kuma (Actuel)",id:"-uptime-kuma-actuel",level:2},{value:"Fonction",id:"fonction",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Monitors configur\xe9s",id:"monitors-configur\xe9s",level:3},{value:"Notifications Discord (Iris \ud83c\udf08)",id:"notifications-discord-iris-",level:3},{value:"Limitations",id:"limitations",level:3},{value:"\ud83d\udcca Prometheus + Grafana (\xc0 d\xe9ployer)",id:"-prometheus--grafana-\xe0-d\xe9ployer",level:2},{value:"Fonction",id:"fonction-1",level:3},{value:"Architecture",id:"architecture",level:3},{value:"Stack Docker Compose",id:"stack-docker-compose",level:3},{value:"Configuration Prometheus",id:"configuration-prometheus",level:3},{value:"Dashboards Grafana",id:"dashboards-grafana",level:3},{value:"Acc\xe8s",id:"acc\xe8s",level:3},{value:"Alertes Prometheus",id:"alertes-prometheus",level:3},{value:"\ud83d\udcc8 M\xe9triques \xe0 surveiller",id:"-m\xe9triques-\xe0-surveiller",level:2},{value:"Syst\xe8me (Node Exporter)",id:"syst\xe8me-node-exporter",level:3},{value:"Docker (cAdvisor)",id:"docker-cadvisor",level:3},{value:"Services",id:"services",level:3},{value:"Infrastructure",id:"infrastructure",level:3},{value:"\ud83d\udd14 Strat\xe9gie d&#39;alertes",id:"-strat\xe9gie-dalertes",level:2},{value:"Niveaux de s\xe9v\xe9rit\xe9",id:"niveaux-de-s\xe9v\xe9rit\xe9",level:3},{value:"Alertes configur\xe9es",id:"alertes-configur\xe9es",level:3},{value:"Uptime Kuma (Actuel)",id:"uptime-kuma-actuel",level:4},{value:"Prometheus (\xc0 venir)",id:"prometheus-\xe0-venir",level:4},{value:"Canaux de notification",id:"canaux-de-notification",level:3},{value:"\ud83d\udcca Dashboards",id:"-dashboards",level:2},{value:"Dashboard 1 : Vue d&#39;ensemble",id:"dashboard-1--vue-densemble",level:3},{value:"Dashboard 2 : Infrastructure",id:"dashboard-2--infrastructure",level:3},{value:"Dashboard 3 : Docker",id:"dashboard-3--docker",level:3},{value:"Dashboard 4 : Services",id:"dashboard-4--services",level:3},{value:"\ud83d\udee0\ufe0f Maintenance",id:"\ufe0f-maintenance",level:2},{value:"Updates",id:"updates",level:3},{value:"Backup",id:"backup",level:3},{value:"\ud83d\udccb Checklist d\xe9ploiement Prometheus",id:"-checklist-d\xe9ploiement-prometheus",level:2},{value:"\ud83d\udd17 Ressources",id:"-ressources",level:2}];function d(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",input:"input",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"-monitoring",children:"\ud83d\udcca Monitoring"})}),"\n",(0,i.jsx)(n.p,{children:"Infrastructure de surveillance compl\xe8te d'Olympus Lab."}),"\n",(0,i.jsx)(n.h2,{id:"-objectifs",children:"\ud83c\udfaf Objectifs"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Surveillance 24/7 de tous les services"}),"\n",(0,i.jsx)(n.li,{children:"Alertes en temps r\xe9el (Discord)"}),"\n",(0,i.jsx)(n.li,{children:"M\xe9triques de performance"}),"\n",(0,i.jsx)(n.li,{children:"Historique et dashboards"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-architecture",children:"\ud83d\udcd0 Architecture"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502         Uptime Kuma (L\xe9ger)             \u2502\n\u2502    - Availability monitoring            \u2502\n\u2502    - HTTP/HTTPS checks                  \u2502\n\u2502    - Alertes Discord (Iris)             \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    +\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502    Prometheus + Grafana (\xc0 venir)       \u2502\n\u2502    - M\xe9triques syst\xe8me                  \u2502\n\u2502    - CPU, RAM, Disque, R\xe9seau           \u2502\n\u2502    - Dashboards visuels                 \u2502\n\u2502    - Alertes avanc\xe9es                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n                    +\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502      Logs (\xc0 venir)                     \u2502\n\u2502    - Loki pour centralisation           \u2502\n\u2502    - Analyse des logs                   \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-uptime-kuma-actuel",children:"\ud83d\udfe2 Uptime Kuma (Actuel)"}),"\n",(0,i.jsx)(n.h3,{id:"fonction",children:"Fonction"}),"\n",(0,i.jsx)(n.p,{children:"Monitoring de disponibilit\xe9 (uptime) des services HTTP/HTTPS"}),"\n",(0,i.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Container"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'services:\n  uptime-kuma:\n    image: louislam/uptime-kuma:latest\n    container_name: uptime-kuma\n    restart: unless-stopped\n    ports:\n      - "3001:3001"\n    volumes:\n      - uptime-kuma:/app/data\n\nvolumes:\n  uptime-kuma:\n'})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Acc\xe8s"})," : https: //uptime.[domain].org"]}),"\n",(0,i.jsx)(n.h3,{id:"monitors-configur\xe9s",children:"Monitors configur\xe9s"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Service"}),(0,i.jsx)(n.th,{children:"Type"}),(0,i.jsx)(n.th,{children:"URL"}),(0,i.jsx)(n.th,{children:"Intervalle"}),(0,i.jsx)(n.th,{children:"Retry"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Proxmox"}),(0,i.jsx)(n.td,{children:"HTTP(s)"}),(0,i.jsx)(n.td,{children:"https: //proxmox.[domain].org"}),(0,i.jsx)(n.td,{children:"60s"}),(0,i.jsx)(n.td,{children:"3"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"OPNsense"}),(0,i.jsx)(n.td,{children:"HTTP(s)"}),(0,i.jsx)(n.td,{children:"https: //opnsense.[domain].org"}),(0,i.jsx)(n.td,{children:"60s"}),(0,i.jsx)(n.td,{children:"3"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Dockge"}),(0,i.jsx)(n.td,{children:"HTTP(s)"}),(0,i.jsx)(n.td,{children:"https: //dockge.[domain].org"}),(0,i.jsx)(n.td,{children:"60s"}),(0,i.jsx)(n.td,{children:"3"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Nextcloud"}),(0,i.jsx)(n.td,{children:"HTTP(s)"}),(0,i.jsx)(n.td,{children:"https: //nextcloud.[domain].org"}),(0,i.jsx)(n.td,{children:"60s"}),(0,i.jsx)(n.td,{children:"3"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"Documentation"}),(0,i.jsx)(n.td,{children:"HTTP(s)"}),(0,i.jsx)(n.td,{children:"https: //docs.[domain].org"}),(0,i.jsx)(n.td,{children:"300s"}),(0,i.jsx)(n.td,{children:"2"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"notifications-discord-iris-",children:"Notifications Discord (Iris \ud83c\udf08)"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Bot"})," : Iris (d\xe9esse messag\xe8re)"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Webhook"})," : [\xe0 ne pas publier]"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Notifications"})," :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\ud83d\udfe2 Service UP"}),"\n",(0,i.jsx)(n.li,{children:"\ud83d\udd34 Service DOWN"}),"\n",(0,i.jsx)(n.li,{children:"\ud83d\udfe1 Service SLOW (> 2000ms)"}),"\n",(0,i.jsx)(n.li,{children:"\ud83d\udcca Rapport quotidien (optionnel)"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Configuration"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"Settings \u2192 Notifications \u2192 Discord\nName: Iris\nWebhook URL: [webhook]\nFriendly Name: Iris\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Messages exemples"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\ud83d\udfe2 Iris: Proxmox is back online\n\ud83d\udd34 Iris: OPNsense is DOWN!\n\ud83d\udfe1 Iris: Nextcloud response time: 2500ms (slow)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"limitations",children:"Limitations"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\u274c Pas de m\xe9triques d\xe9taill\xe9es (CPU, RAM, etc.)"}),"\n",(0,i.jsx)(n.li,{children:"\u274c Pas de dashboards visuels"}),"\n",(0,i.jsx)(n.li,{children:"\u274c Pas d'historique long terme"}),"\n",(0,i.jsx)(n.li,{children:"\u274c Monitoring externe uniquement (pas interne)"}),"\n"]}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"\u2192 C'est pourquoi on va ajouter Prometheus + Grafana"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-prometheus--grafana-\xe0-d\xe9ployer",children:"\ud83d\udcca Prometheus + Grafana (\xc0 d\xe9ployer)"}),"\n",(0,i.jsx)(n.h3,{id:"fonction-1",children:"Fonction"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Prometheus"})," : Collecte et stockage des m\xe9triques"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Grafana"})," : Visualisation et dashboards"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"architecture",children:"Architecture"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502             Grafana                     \u2502\n\u2502         (Dashboards)                    \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502\n               \u2193 (Query)\n\u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502          Prometheus                     \u2502\n\u2502      (M\xe9triques storage)                \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u252c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n               \u2502\n               \u2193 (Scrape)\n      \u250c\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2534\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2510\n      \u2502                 \u2502\n\u250c\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2510    \u250c\u2500\u2500\u2500\u2500\u2500\u25bc\u2500\u2500\u2500\u2500\u2500\u2510\n\u2502  Node     \u2502    \u2502  cAdvisor \u2502\n\u2502 Exporter  \u2502    \u2502  (Docker) \u2502\n\u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518    \u2514\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2500\u2518\n"})}),"\n",(0,i.jsx)(n.h3,{id:"stack-docker-compose",children:"Stack Docker Compose"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"services:\n  prometheus:\n    image: prom/prometheus:latest\n    container_name: prometheus\n    restart: unless-stopped\n    ports:\n      - \"9090:9090\"\n    volumes:\n      - ./prometheus.yml:/etc/prometheus/prometheus.yml:ro\n      - prometheus_data:/prometheus\n    command:\n      - '--config.file=/etc/prometheus/prometheus.yml'\n      - '--storage.tsdb.path=/prometheus'\n      - '--storage.tsdb.retention.time=30d'\n    networks:\n      - monitoring\n\n  grafana:\n    image: grafana/grafana:latest\n    container_name: grafana\n    restart: unless-stopped\n    ports:\n      - \"3000:3000\"\n    environment:\n      - GF_SECURITY_ADMIN_PASSWORD=[mot-de-passe-fort]\n      - GF_SERVER_ROOT_URL=https: //grafana.[domain].org\n    volumes:\n      - grafana_data:/var/lib/grafana\n    depends_on:\n      - prometheus\n    networks:\n      - monitoring\n\n  node-exporter:\n    image: prom/node-exporter:latest\n    container_name: node-exporter\n    restart: unless-stopped\n    ports:\n      - \"9100:9100\"\n    command:\n      - '--path.procfs=/host/proc'\n      - '--path.sysfs=/host/sys'\n      - '--collector.filesystem.mount-points-exclude=^/(sys|proc|dev|host|etc)($$|/)'\n    volumes:\n      - /proc:/host/proc:ro\n      - /sys:/host/sys:ro\n      - /:/rootfs:ro\n    networks:\n      - monitoring\n\n  cadvisor:\n    image: gcr.io/cadvisor/cadvisor:latest\n    container_name: cadvisor\n    restart: unless-stopped\n    ports:\n      - \"8080:8080\"\n    volumes:\n      - /:/rootfs:ro\n      - /var/run:/var/run:ro\n      - /sys:/sys:ro\n      - /var/lib/docker/:/var/lib/docker:ro\n    networks:\n      - monitoring\n\nvolumes:\n  prometheus_data:\n  grafana_data:\n\nnetworks:\n  monitoring:\n"})}),"\n",(0,i.jsx)(n.h3,{id:"configuration-prometheus",children:"Configuration Prometheus"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Fichier"})," : ",(0,i.jsx)(n.code,{children:"prometheus.yml"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:"global:\n  scrape_interval: 15s\n  evaluation_interval: 15s\n\nscrape_configs:\n  # Prometheus lui-m\xeame\n  - job_name: 'prometheus'\n    static_configs:\n      - targets: ['localhost:9090']\n\n  # Node Exporter (m\xe9triques syst\xe8me)\n  - job_name: 'node-exporter'\n    static_configs:\n      - targets: ['node-exporter:9100']\n\n  # cAdvisor (m\xe9triques Docker)\n  - job_name: 'cadvisor'\n    static_configs:\n      - targets: ['cadvisor:8080']\n\n  # Proxmox (\xe0 configurer)\n  - job_name: 'proxmox'\n    static_configs:\n      - targets: ['192.168.1.51:9221']\n\n  # OPNsense (\xe0 configurer)\n  - job_name: 'opnsense'\n    static_configs:\n      - targets: ['10.0.1.1:9273']\n"})}),"\n",(0,i.jsx)(n.h3,{id:"dashboards-grafana",children:"Dashboards Grafana"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\xc0 importer"})," :"]}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Node Exporter Full"})," (ID: 1860)"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"CPU, RAM, Disque, R\xe9seau"}),"\n",(0,i.jsx)(n.li,{children:"Pour la VM Docker"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Docker Container & Host Metrics"})," (ID: 10619)"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"M\xe9triques de tous les containers"}),"\n",(0,i.jsx)(n.li,{children:"cAdvisor"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Proxmox"})," (ID: 10347)"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Monitoring Proxmox VE"}),"\n"]}),"\n"]}),"\n",(0,i.jsxs)(n.li,{children:["\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Custom Dashboard"})," (\xe0 cr\xe9er)"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Vue d'ensemble Olympus Lab"}),"\n",(0,i.jsx)(n.li,{children:"Services critiques"}),"\n",(0,i.jsx)(n.li,{children:"Alertes actives"}),"\n"]}),"\n"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"acc\xe8s",children:"Acc\xe8s"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Prometheus"})," : https: //prometheus.[domain].org"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Grafana"})," : https: //grafana.[domain].org"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Login Grafana"})," : admin / [mot-de-passe]"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"alertes-prometheus",children:"Alertes Prometheus"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Fichier"})," : ",(0,i.jsx)(n.code,{children:"alert.rules.yml"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-yaml",children:'groups:\n  - name: olympus_lab\n    interval: 30s\n    rules:\n      # CPU \xe9lev\xe9\n      - alert: HighCPU\n        expr: 100 - (avg by(instance) (irate(node_cpu_seconds_total{mode="idle"}[5m])) * 100) > 80\n        for: 5m\n        labels:\n          severity: warning\n        annotations:\n          summary: "High CPU on {{ $labels.instance }}"\n          description: "CPU usage is above 80% (current: {{ $value }}%)"\n\n      # RAM \xe9lev\xe9e\n      - alert: HighMemory\n        expr: (node_memory_MemAvailable_bytes / node_memory_MemTotal_bytes) * 100 < 10\n        for: 5m\n        labels:\n          severity: warning\n        annotations:\n          summary: "Low memory on {{ $labels.instance }}"\n          description: "Available memory is below 10% (current: {{ $value }}%)"\n\n      # Disque plein\n      - alert: DiskSpaceLow\n        expr: (node_filesystem_avail_bytes{mountpoint="/"} / node_filesystem_size_bytes{mountpoint="/"}) * 100 < 15\n        for: 5m\n        labels:\n          severity: critical\n        annotations:\n          summary: "Low disk space on {{ $labels.instance }}"\n          description: "Disk space is below 15% (current: {{ $value }}%)"\n\n      # Container down\n      - alert: ContainerDown\n        expr: absent(container_last_seen{name=~"nextcloud|uptime-kuma|dockge"})\n        for: 2m\n        labels:\n          severity: critical\n        annotations:\n          summary: "Container {{ $labels.name }} is down"\n          description: "Critical container is not running"\n'})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-m\xe9triques-\xe0-surveiller",children:"\ud83d\udcc8 M\xe9triques \xe0 surveiller"}),"\n",(0,i.jsx)(n.h3,{id:"syst\xe8me-node-exporter",children:"Syst\xe8me (Node Exporter)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"CPU"})," : Utilisation par core, load average"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"RAM"})," : Utilis\xe9e, disponible, swap"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Disque"})," : Espace utilis\xe9, IOPS, latence"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"R\xe9seau"})," : Bande passante, paquets, erreurs"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"docker-cadvisor",children:"Docker (cAdvisor)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Containers"})," : CPU, RAM par container"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Volumes"})," : Espace utilis\xe9"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Networks"})," : Trafic inter-containers"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"services",children:"Services"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Uptime"})," : Disponibilit\xe9 %"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Response time"})," : Latence HTTP"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Errors"})," : 4xx, 5xx"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"infrastructure",children:"Infrastructure"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Proxmox"})," : VMs actives, ressources"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"OPNsense"})," : Firewall rules, trafic"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Cloudflare Tunnel"})," : Connexions actives"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-strat\xe9gie-dalertes",children:"\ud83d\udd14 Strat\xe9gie d'alertes"}),"\n",(0,i.jsx)(n.h3,{id:"niveaux-de-s\xe9v\xe9rit\xe9",children:"Niveaux de s\xe9v\xe9rit\xe9"}),"\n",(0,i.jsxs)(n.table,{children:[(0,i.jsx)(n.thead,{children:(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.th,{children:"Niveau"}),(0,i.jsx)(n.th,{children:"Description"}),(0,i.jsx)(n.th,{children:"Action"})]})}),(0,i.jsxs)(n.tbody,{children:[(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\ud83d\udfe2 Info"}),(0,i.jsx)(n.td,{children:"Information"}),(0,i.jsx)(n.td,{children:"Log uniquement"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\ud83d\udfe1 Warning"}),(0,i.jsx)(n.td,{children:"Attention requise"}),(0,i.jsx)(n.td,{children:"Discord Iris"})]}),(0,i.jsxs)(n.tr,{children:[(0,i.jsx)(n.td,{children:"\ud83d\udd34 Critical"}),(0,i.jsx)(n.td,{children:"Action imm\xe9diate"}),(0,i.jsx)(n.td,{children:"Discord + SMS (futur)"})]})]})]}),"\n",(0,i.jsx)(n.h3,{id:"alertes-configur\xe9es",children:"Alertes configur\xe9es"}),"\n",(0,i.jsx)(n.h4,{id:"uptime-kuma-actuel",children:"Uptime Kuma (Actuel)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\ud83d\udd34 Service DOWN > 2 min"}),"\n",(0,i.jsx)(n.li,{children:"\ud83d\udfe1 Response time > 2000ms"}),"\n"]}),"\n",(0,i.jsx)(n.h4,{id:"prometheus-\xe0-venir",children:"Prometheus (\xc0 venir)"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"\ud83d\udd34 CPU > 90% pendant 5 min"}),"\n",(0,i.jsx)(n.li,{children:"\ud83d\udd34 RAM < 5% disponible"}),"\n",(0,i.jsx)(n.li,{children:"\ud83d\udd34 Disque < 10% disponible"}),"\n",(0,i.jsx)(n.li,{children:"\ud83d\udd34 Container critique DOWN > 1 min"}),"\n",(0,i.jsx)(n.li,{children:"\ud83d\udfe1 CPU > 80% pendant 5 min"}),"\n",(0,i.jsx)(n.li,{children:"\ud83d\udfe1 RAM < 15% disponible"}),"\n",(0,i.jsx)(n.li,{children:"\ud83d\udfe1 Disque < 20% disponible"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"canaux-de-notification",children:"Canaux de notification"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Actuel"})," :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Discord (Iris) via Uptime Kuma"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"\xc0 venir"})," :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Discord (Iris) via Alertmanager (Prometheus)"}),"\n",(0,i.jsx)(n.li,{children:"Email (pour alertes critiques)"}),"\n",(0,i.jsx)(n.li,{children:"SMS / PagerDuty (alertes \ud83d\udd34 uniquement)"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-dashboards",children:"\ud83d\udcca Dashboards"}),"\n",(0,i.jsx)(n.h3,{id:"dashboard-1--vue-densemble",children:"Dashboard 1 : Vue d'ensemble"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Contenu"})," :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Status de tous les services (UP/DOWN)"}),"\n",(0,i.jsx)(n.li,{children:"CPU/RAM/Disque global"}),"\n",(0,i.jsx)(n.li,{children:"Trafic r\xe9seau"}),"\n",(0,i.jsx)(n.li,{children:"Alertes actives"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"dashboard-2--infrastructure",children:"Dashboard 2 : Infrastructure"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Contenu"})," :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Proxmox : VMs, LXC, ressources"}),"\n",(0,i.jsx)(n.li,{children:"OPNsense : Firewall, WAN/LAN"}),"\n",(0,i.jsx)(n.li,{children:"Cloudflare : Tunnel status, requ\xeates"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"dashboard-3--docker",children:"Dashboard 3 : Docker"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Contenu"})," :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Tous les containers (CPU, RAM)"}),"\n",(0,i.jsx)(n.li,{children:"Volumes (espace)"}),"\n",(0,i.jsx)(n.li,{children:"Networks (trafic)"}),"\n",(0,i.jsx)(n.li,{children:"Images (versions)"}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"dashboard-4--services",children:"Dashboard 4 : Services"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Contenu"})," :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:"Nextcloud : Users, files, storage"}),"\n",(0,i.jsx)(n.li,{children:"Uptime Kuma : Uptime %, response times"}),"\n",(0,i.jsx)(n.li,{children:"Dockge : Stacks actives"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"\ufe0f-maintenance",children:"\ud83d\udee0\ufe0f Maintenance"}),"\n",(0,i.jsx)(n.h3,{id:"updates",children:"Updates"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Uptime Kuma"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/stacks/uptime-kuma\ndocker compose pull\ndocker compose up -d\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Prometheus + Grafana"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"cd ~/stacks/monitoring\ndocker compose pull\ndocker compose up -d\n"})}),"\n",(0,i.jsx)(n.h3,{id:"backup",children:"Backup"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Uptime Kuma"})," :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Volume : ",(0,i.jsx)(n.code,{children:"uptime-kuma"})]}),"\n",(0,i.jsx)(n.li,{children:"Fr\xe9quence : Hebdomadaire"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Prometheus"})," :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Volume : ",(0,i.jsx)(n.code,{children:"prometheus_data"})]}),"\n",(0,i.jsx)(n.li,{children:"Retention : 30 jours"}),"\n",(0,i.jsx)(n.li,{children:"Backup : Optionnel (donn\xe9es reconstructibles)"}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Grafana"})," :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Volume : ",(0,i.jsx)(n.code,{children:"grafana_data"})]}),"\n",(0,i.jsx)(n.li,{children:"Dashboards : Export JSON mensuel"}),"\n",(0,i.jsx)(n.li,{children:"Fr\xe9quence : Hebdomadaire"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-checklist-d\xe9ploiement-prometheus",children:"\ud83d\udccb Checklist d\xe9ploiement Prometheus"}),"\n",(0,i.jsxs)(n.ul,{className:"contains-task-list",children:["\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Cr\xe9er la stack dans Dockge"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Configurer ",(0,i.jsx)(n.code,{children:"prometheus.yml"})]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","D\xe9ployer Node Exporter"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","D\xe9ployer cAdvisor"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Configurer alertes"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Ajouter dans Cloudflare Tunnel"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Cr\xe9er DNS records"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Configurer Cloudflare Access"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Importer dashboards Grafana"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Configurer Alertmanager \u2192 Discord"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Tester alertes"]}),"\n",(0,i.jsxs)(n.li,{className:"task-list-item",children:[(0,i.jsx)(n.input,{type:"checkbox",disabled:!0})," ","Documenter"]}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"-ressources",children:"\ud83d\udd17 Ressources"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Documentation"})," :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Uptime Kuma : ",(0,i.jsx)(n.a,{href:"https://github.com/louislam/uptime-kuma",children:"https://github.com/louislam/uptime-kuma"})]}),"\n",(0,i.jsxs)(n.li,{children:["Prometheus : ",(0,i.jsx)(n.a,{href:"https://prometheus.io/docs/",children:"https://prometheus.io/docs/"})]}),"\n",(0,i.jsxs)(n.li,{children:["Grafana : ",(0,i.jsx)(n.a,{href:"https://grafana.com/docs/",children:"https://grafana.com/docs/"})]}),"\n",(0,i.jsxs)(n.li,{children:["Node Exporter : ",(0,i.jsx)(n.a,{href:"https://github.com/prometheus/node_exporter",children:"https://github.com/prometheus/node_exporter"})]}),"\n",(0,i.jsxs)(n.li,{children:["cAdvisor : ",(0,i.jsx)(n.a,{href:"https://github.com/google/cadvisor",children:"https://github.com/google/cadvisor"})]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Dashboards Grafana"})," :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsx)(n.li,{children:(0,i.jsx)(n.a,{href:"https://grafana.com/grafana/dashboards/",children:"https://grafana.com/grafana/dashboards/"})}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Guides"})," :"]}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:["Prometheus + Grafana avec Docker : ",(0,i.jsx)(n.a,{href:"https://grafana.com/docs/grafana/latest/setup-grafana/installation/docker/",children:"https://grafana.com/docs/grafana/latest/setup-grafana/installation/docker/"})]}),"\n"]})]})}function h(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,n,s)=>{s.d(n,{R:()=>t,x:()=>o});var r=s(6540);const i={},l=r.createContext(i);function t(e){const n=r.useContext(l);return r.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function o(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:t(e.components),r.createElement(l.Provider,{value:n},e.children)}}}]);