"use strict";(globalThis.webpackChunkhomelab_docs=globalThis.webpackChunkhomelab_docs||[]).push([[8655],{7751:(e,n,r)=>{r.r(n),r.d(n,{assets:()=>o,contentTitle:()=>t,default:()=>u,frontMatter:()=>a,metadata:()=>s,toc:()=>d});const s=JSON.parse('{"id":"homelab/infrastructure/proxmox","title":"Proxmox VE - Atlas","description":"Configuration mat\xe9rielle","source":"@site/docs/homelab/infrastructure/proxmox.md","sourceDirName":"homelab/infrastructure","slug":"/homelab/infrastructure/proxmox","permalink":"/docs/homelab/infrastructure/proxmox","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/homelab/infrastructure/proxmox.md","tags":[],"version":"current","sidebarPosition":2,"frontMatter":{"sidebar_position":2},"sidebar":"tutorialSidebar","previous":{"title":"Vue d\'ensemble de l\'infrastructure","permalink":"/docs/homelab/infrastructure/overview"},"next":{"title":"OPNsense - Olympus","permalink":"/docs/homelab/infrastructure/opnsense"}}');var i=r(4848),l=r(8453);const a={sidebar_position:2},t="Proxmox VE - Atlas",o={},d=[{value:"Configuration mat\xe9rielle",id:"configuration-mat\xe9rielle",level:2},{value:"Serveur physique",id:"serveur-physique",level:3},{value:"Activation virtualisation BIOS",id:"activation-virtualisation-bios",level:3},{value:"Configuration r\xe9seau",id:"configuration-r\xe9seau",level:2},{value:"Interfaces r\xe9seau",id:"interfaces-r\xe9seau",level:3},{value:"Bridges configur\xe9s",id:"bridges-configur\xe9s",level:3},{value:"vmbr0 - WAN/Management (Physique)",id:"vmbr0---wanmanagement-physique",level:4},{value:"vmbr1 - LAN (Virtuel)",id:"vmbr1---lan-virtuel",level:4},{value:"vmbr2 - DMZ (Virtuel)",id:"vmbr2---dmz-virtuel",level:4},{value:"vmbr3 - DEV (Virtuel)",id:"vmbr3---dev-virtuel",level:4},{value:"vmbr4 - MGMT (Virtuel)",id:"vmbr4---mgmt-virtuel",level:4},{value:"D\xe9p\xf4ts Proxmox",id:"d\xe9p\xf4ts-proxmox",level:2},{value:"Probl\xe8me : Erreurs 401 Enterprise",id:"probl\xe8me--erreurs-401-enterprise",level:3},{value:"Solution : D\xe9p\xf4ts no-subscription",id:"solution--d\xe9p\xf4ts-no-subscription",level:3},{value:"DynDNS avec Cloudflare",id:"dyndns-avec-cloudflare",level:2},{value:"Installation ddclient",id:"installation-ddclient",level:3},{value:"Configuration",id:"configuration",level:3},{value:"Gestion du service",id:"gestion-du-service",level:3},{value:"Acc\xe8s",id:"acc\xe8s",level:2},{value:"Interface Web",id:"interface-web",level:3},{value:"SSH",id:"ssh",level:3},{value:"Commandes utiles",id:"commandes-utiles",level:2},{value:"Gestion des VMs",id:"gestion-des-vms",level:3},{value:"Gestion des Containers",id:"gestion-des-containers",level:3},{value:"R\xe9seau",id:"r\xe9seau",level:3},{value:"Mises \xe0 jour",id:"mises-\xe0-jour",level:2},{value:"Mise \xe0 jour automatique",id:"mise-\xe0-jour-automatique",level:3},{value:"Mise \xe0 jour manuelle",id:"mise-\xe0-jour-manuelle",level:3},{value:"Fr\xe9quence recommand\xe9e",id:"fr\xe9quence-recommand\xe9e",level:3},{value:"V\xe9rifier la version",id:"v\xe9rifier-la-version",level:3},{value:"Backup",id:"backup",level:2},{value:"Snapshots manuels",id:"snapshots-manuels",level:3},{value:"Backup automatique (\xe0 configurer)",id:"backup-automatique-\xe0-configurer",level:3},{value:"Troubleshooting",id:"troubleshooting",level:2},{value:"VM ne d\xe9marre pas",id:"vm-ne-d\xe9marre-pas",level:3},{value:"Probl\xe8me r\xe9seau",id:"probl\xe8me-r\xe9seau",level:3},{value:"Espace disque plein",id:"espace-disque-plein",level:3}];function c(e){const n={a:"a",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",hr:"hr",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,l.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(n.header,{children:(0,i.jsx)(n.h1,{id:"proxmox-ve---atlas",children:"Proxmox VE - Atlas"})}),"\n",(0,i.jsx)(n.h2,{id:"configuration-mat\xe9rielle",children:"Configuration mat\xe9rielle"}),"\n",(0,i.jsx)(n.h3,{id:"serveur-physique",children:"Serveur physique"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Mod\xe8le"})," : Lenovo ThinkCentre M710S"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Hostname"})," : atlas (anciennement fox-factory)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Processeur"})," : Intel (VT-x et VT-d activ\xe9s)"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"RAM"})," : [\xc0 compl\xe9ter]"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Stockage"})," : [\xc0 compl\xe9ter]"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"activation-virtualisation-bios",children:"Activation virtualisation BIOS"}),"\n",(0,i.jsx)(n.p,{children:"Dans le BIOS du ThinkCentre M710S :"}),"\n",(0,i.jsxs)(n.ol,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"F1"})," au d\xe9marrage pour entrer dans le BIOS"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Security"})," \u2192 ",(0,i.jsx)(n.strong,{children:"Virtualization"})]}),"\n",(0,i.jsxs)(n.li,{children:["Activer ",(0,i.jsx)(n.strong,{children:"Intel VT-x"})," \u2705"]}),"\n",(0,i.jsxs)(n.li,{children:["Activer ",(0,i.jsx)(n.strong,{children:"Intel VT-d"})," \u2705"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"F10"})," pour sauvegarder"]}),"\n"]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"V\xe9rification"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"egrep -c '(vmx|svm)' /proc/cpuinfo\n# Doit retourner > 0 (nombre de cores)\n\ndmesg | grep -e DMAR -e IOMMU\n# Doit montrer que l'IOMMU est actif\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"configuration-r\xe9seau",children:"Configuration r\xe9seau"}),"\n",(0,i.jsx)(n.h3,{id:"interfaces-r\xe9seau",children:"Interfaces r\xe9seau"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Interface physique"})," : ",(0,i.jsx)(n.code,{children:"enp1s0"})]}),"\n",(0,i.jsx)(n.h3,{id:"bridges-configur\xe9s",children:"Bridges configur\xe9s"}),"\n",(0,i.jsxs)(n.p,{children:["Fichier : ",(0,i.jsx)(n.code,{children:"/etc/network/interfaces"})]}),"\n",(0,i.jsx)(n.h4,{id:"vmbr0---wanmanagement-physique",children:"vmbr0 - WAN/Management (Physique)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"auto vmbr0\niface vmbr0 inet static\n    address 192.168.1.51/24\n    gateway 192.168.1.254\n    bridge-ports enp1s0\n    bridge-stp off\n    bridge-fd 0\n"})}),"\n",(0,i.jsx)(n.h4,{id:"vmbr1---lan-virtuel",children:"vmbr1 - LAN (Virtuel)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"auto vmbr1\niface vmbr1 inet manual\n    bridge-ports none\n    bridge-stp off\n    bridge-fd 0\n    bridge-vlan-aware yes\n"})}),"\n",(0,i.jsx)(n.h4,{id:"vmbr2---dmz-virtuel",children:"vmbr2 - DMZ (Virtuel)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"auto vmbr2\niface vmbr2 inet manual\n    bridge-ports none\n    bridge-stp off\n    bridge-fd 0\n    bridge-vlan-aware yes\n"})}),"\n",(0,i.jsx)(n.h4,{id:"vmbr3---dev-virtuel",children:"vmbr3 - DEV (Virtuel)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"auto vmbr3\niface vmbr3 inet manual\n    bridge-ports none\n    bridge-stp off\n    bridge-fd 0\n    bridge-vlan-aware yes\n"})}),"\n",(0,i.jsx)(n.h4,{id:"vmbr4---mgmt-virtuel",children:"vmbr4 - MGMT (Virtuel)"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"auto vmbr4\niface vmbr4 inet manual\n    bridge-ports none\n    bridge-stp off\n    bridge-fd 0\n    bridge-vlan-aware yes\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"V\xe9rification"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"brctl show\n# Doit lister les 5 bridges\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"d\xe9p\xf4ts-proxmox",children:"D\xe9p\xf4ts Proxmox"}),"\n",(0,i.jsx)(n.h3,{id:"probl\xe8me--erreurs-401-enterprise",children:"Probl\xe8me : Erreurs 401 Enterprise"}),"\n",(0,i.jsx)(n.p,{children:"Par d\xe9faut, Proxmox essaie d'utiliser les d\xe9p\xf4ts Enterprise (payants)."}),"\n",(0,i.jsx)(n.h3,{id:"solution--d\xe9p\xf4ts-no-subscription",children:"Solution : D\xe9p\xf4ts no-subscription"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# D\xe9sactiver les d\xe9p\xf4ts enterprise\nmv /etc/apt/sources.list.d/pve-enterprise.sources \\\n   /etc/apt/sources.list.d/pve-enterprise.sources.disabled\n\nmv /etc/apt/sources.list.d/ceph.sources \\\n   /etc/apt/sources.list.d/ceph.sources.disabled\n\n# Mettre \xe0 jour\napt update\napt upgrade -y\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"dyndns-avec-cloudflare",children:"DynDNS avec Cloudflare"}),"\n",(0,i.jsx)(n.h3,{id:"installation-ddclient",children:"Installation ddclient"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"apt install ddclient -y\n"})}),"\n",(0,i.jsx)(n.h3,{id:"configuration",children:"Configuration"}),"\n",(0,i.jsxs)(n.p,{children:["Fichier : ",(0,i.jsx)(n.code,{children:"/etc/ddclient.conf"})]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{children:"daemon=300\nsyslog=yes\nuse=web, web=checkip.dyndns.org/, web-skip='IP Address'\n\nprotocol=cloudflare\nzone=olympus-lab.org\nttl=1\nlogin=token\npassword=VOTRE_TOKEN_CLOUDFLARE\nvpn.olympus-lab.org\n"})}),"\n",(0,i.jsx)(n.h3,{id:"gestion-du-service",children:"Gestion du service"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# D\xe9marrer\nsystemctl start ddclient\n\n# Activer au boot\nsystemctl enable ddclient\n\n# V\xe9rifier le statut\nsystemctl status ddclient\n\n# Voir les logs\njournalctl -u ddclient -f\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Test"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"nslookup vpn.olympus-lab.org\n# Doit retourner votre IP publique\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"acc\xe8s",children:"Acc\xe8s"}),"\n",(0,i.jsx)(n.h3,{id:"interface-web",children:"Interface Web"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Local"})," : ",(0,i.jsx)(n.a,{href:"https://192.168.1.51:8006",children:"https://192.168.1.51:8006"}),"\n",(0,i.jsx)(n.strong,{children:"Distant"})," : ",(0,i.jsx)(n.a,{href:"https://proxmox.olympus-lab.org",children:"https://proxmox.olympus-lab.org"})]}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Login"})," : root / [mot de passe]"]}),"\n",(0,i.jsx)(n.h3,{id:"ssh",children:"SSH"}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Local"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ssh root@192.168.1.51\n"})}),"\n",(0,i.jsxs)(n.p,{children:[(0,i.jsx)(n.strong,{children:"Distant (via Cloudflare Tunnel)"})," :"]}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"ssh ssh-proxmox\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"commandes-utiles",children:"Commandes utiles"}),"\n",(0,i.jsx)(n.h3,{id:"gestion-des-vms",children:"Gestion des VMs"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Lister les VMs\nqm list\n\n# Statut\nqm status 100\n\n# D\xe9marrer/Arr\xeater\nqm start 100\nqm stop 100\n\n# Console\nqm terminal 100\n\n# Snapshot\nqm snapshot 100 backup-$(date +%Y%m%d)\n\n# Cloner\nqm clone 100 101 --name nouvelle-vm\n"})}),"\n",(0,i.jsx)(n.h3,{id:"gestion-des-containers",children:"Gestion des Containers"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Lister les containers\npct list\n\n# Statut\npct status 200\n\n# D\xe9marrer/Arr\xeater\npct start 200\npct stop 200\n\n# Entrer dans le container\npct enter 200\n\n# Snapshot\npct snapshot 200 backup-$(date +%Y%m%d)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"r\xe9seau",children:"R\xe9seau"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Voir les bridges\nbrctl show\n\n# Tester la connectivit\xe9\nping 10.0.1.1\n\n# Voir les routes\nip route show\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"mises-\xe0-jour",children:"Mises \xe0 jour"}),"\n",(0,i.jsx)(n.h3,{id:"mise-\xe0-jour-automatique",children:"Mise \xe0 jour automatique"}),"\n",(0,i.jsx)(n.p,{children:(0,i.jsx)(n.strong,{children:"Proxmox ne se met PAS \xe0 jour automatiquement."})}),"\n",(0,i.jsx)(n.h3,{id:"mise-\xe0-jour-manuelle",children:"Mise \xe0 jour manuelle"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Via SSH\nssh ssh-proxmox\n\n# Mise \xe0 jour\napt update\napt dist-upgrade -y\n\n# Red\xe9marrer si kernel mis \xe0 jour\nreboot\n"})}),"\n",(0,i.jsx)(n.h3,{id:"fr\xe9quence-recommand\xe9e",children:"Fr\xe9quence recommand\xe9e"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Mensuel"})," : Mises \xe0 jour de s\xe9curit\xe9"]}),"\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Apr\xe8s alerte"})," : CVE critiques"]}),"\n"]}),"\n",(0,i.jsx)(n.h3,{id:"v\xe9rifier-la-version",children:"V\xe9rifier la version"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"pveversion\n"})}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"backup",children:"Backup"}),"\n",(0,i.jsx)(n.h3,{id:"snapshots-manuels",children:"Snapshots manuels"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# VM\nqm snapshot 100 pre-update-$(date +%Y%m%d)\n\n# Container\npct snapshot 202 pre-update-$(date +%Y%m%d)\n"})}),"\n",(0,i.jsx)(n.h3,{id:"backup-automatique-\xe0-configurer",children:"Backup automatique (\xe0 configurer)"}),"\n",(0,i.jsx)(n.p,{children:"Via l'interface Web :"}),"\n",(0,i.jsxs)(n.ul,{children:["\n",(0,i.jsxs)(n.li,{children:[(0,i.jsx)(n.strong,{children:"Datacenter"})," \u2192 ",(0,i.jsx)(n.strong,{children:"Backup"})]}),"\n",(0,i.jsx)(n.li,{children:"Cr\xe9er un job de backup"}),"\n",(0,i.jsx)(n.li,{children:"Planifier (ex: tous les jours \xe0 2h)"}),"\n"]}),"\n",(0,i.jsx)(n.hr,{}),"\n",(0,i.jsx)(n.h2,{id:"troubleshooting",children:"Troubleshooting"}),"\n",(0,i.jsx)(n.h3,{id:"vm-ne-d\xe9marre-pas",children:"VM ne d\xe9marre pas"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Voir les logs\nqm showcmd 100\n\n# V\xe9rifier la config\ncat /etc/pve/qemu-server/100.conf\n\n# Forcer l'arr\xeat\nqm stop 100 --skiplock\n"})}),"\n",(0,i.jsx)(n.h3,{id:"probl\xe8me-r\xe9seau",children:"Probl\xe8me r\xe9seau"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Red\xe9marrer le networking\nsystemctl restart networking\n\n# V\xe9rifier les bridges\nbrctl show\n\n# Logs r\xe9seau\njournalctl -u networking -f\n"})}),"\n",(0,i.jsx)(n.h3,{id:"espace-disque-plein",children:"Espace disque plein"}),"\n",(0,i.jsx)(n.pre,{children:(0,i.jsx)(n.code,{className:"language-bash",children:"# Voir l'utilisation\ndf -h\n\n# Nettoyer les anciens kernels\napt autoremove -y\n\n# Nettoyer le cache APT\napt clean\n"})})]})}function u(e={}){const{wrapper:n}={...(0,l.R)(),...e.components};return n?(0,i.jsx)(n,{...e,children:(0,i.jsx)(c,{...e})}):c(e)}},8453:(e,n,r)=>{r.d(n,{R:()=>a,x:()=>t});var s=r(6540);const i={},l=s.createContext(i);function a(e){const n=s.useContext(l);return s.useMemo(function(){return"function"==typeof e?e(n):{...n,...e}},[n,e])}function t(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(i):e.components||i:a(e.components),s.createElement(l.Provider,{value:n},e.children)}}}]);